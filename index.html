<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>கணித வரைபட உருவகப்படுத்துதல்</title>
    <style>
        /* CSS Reset and Basic Styles */
        :root {
            --primary-color: #4f46e5;
            --primary-dark: #4338ca;
            --secondary-color: #10b981;
            --background-light: #f5f3ff;
            --text-dark: #1e293b;
            --text-light: #475569;
            --border-color: #d1d5db;
            --white: #ffffff;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--background-light);
            color: var(--text-dark);
            display: flex;
            flex-direction: column;
        }
        
        .no-select {
            -webkit-user-select: none; /* Safari */
            -ms-user-select: none; /* IE 10+ */
            user-select: none; /* Standard syntax */
        }

        /* App Container and Header */
        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .app-header {
            background-color: var(--white);
            padding: 1rem 2rem;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 2px 4px var(--shadow-color);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .app-header h1 {
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            color: var(--primary-color);
            font-weight: 800;
            cursor: pointer;
        }

        .app-header p {
            font-size: clamp(0.75rem, 2vw, 1rem);
            color: var(--text-light);
            margin-top: 0.25rem;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* Home Screen Styles */
        #homeScreen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            flex-grow: 1;
        }
        
        .card-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            width: 100%;
            max-width: 900px;
        }

        .card {
            background: var(--white);
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 10px 15px -3px var(--shadow-color), 0 4px 6px -4px var(--shadow-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
            text-align: center;
            -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px var(--shadow-color), 0 8px 10px -6px var(--shadow-color);
            border-color: var(--primary-color);
        }

        .card h2 {
            font-size: clamp(2.25rem, 7vw, 3.5rem);
            color: var(--primary-dark);
            margin-bottom: 0.5rem;
        }

        .card p {
            color: var(--text-light);
        }
        
        .card.disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: #f9fafb;
        }
        
        .card.disabled:hover {
             transform: none;
             box-shadow: 0 10px 15px -3px var(--shadow-color), 0 4px 6px -4px var(--shadow-color);
             border-color: transparent;
        }

        /* Simulation Screen Styles */
        #simulationScreen {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }
        
        .tab-container {
            display: flex;
            gap: 0.5rem;
            padding: 0 1.5rem;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--white);
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            background-color: transparent;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-light);
            border-bottom: 3px solid transparent;
            transition: all 0.2s ease;
            -webkit-tap-highlight-color: transparent;
        }
        
        .tab-btn:hover {
            color: var(--primary-color);
        }
        
        .tab-btn.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }
        
        .tab-btn:disabled {
            color: #9ca3af;
            cursor: not-allowed;
        }

        .tab-content {
            display: none;
            padding: 1.5rem;
            flex-grow: 1;
        }

        .tab-content.active {
            display: block;
        }
        
        .simulation-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
            height: 100%;
        }

        .panel {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px var(--shadow-color);
        }

        .controls-panel h2 {
            font-size: 1.5rem;
            color: var(--primary-dark);
            margin-bottom: 1rem;
        }

        .controls-panel p {
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .data-table {
            width: 100%;
            text-align: center;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
        }
        
        .data-table th, .data-table td {
            border: 1px solid var(--border-color);
            padding: 0.5rem;
        }

        .data-table td {
            font-size: 1.1rem;
            font-weight: 700;
        }

        .data-table th {
            background-color: #e0e7ff;
        }
        
        .input-group {
            display: flex;
            gap: 0.5rem;
            margin: 1rem 0;
            align-items: center;
            flex-wrap: wrap; /* Allows wrapping on small screens */
        }
        .input-group input {
            flex: 1 1 120px; /* Allow input to grow/shrink with a base size */
            padding: 0.6rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
        }
        #addPointBtn, #addPointBtn2, #addPointBtn3, #addPointBtn4 {
            padding: 0.6rem 0.8rem;
        }

        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .btn {
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            color: var(--white);
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px var(--shadow-color);
            -webkit-tap-highlight-color: transparent;
        }

        .btn-primary {
            background-color: var(--primary-color);
        }
        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background-color: #6b7280;
        }
        .btn-secondary:hover {
             background-color: #4b5563;
        }

        .btn:disabled {
            background-color: #d1d5db;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .formula {
            background-color: #eef2ff;
            border: 1px solid #c7d2fe;
            padding: 0.75rem;
            border-radius: 0.5rem;
            text-align: center;
            color: var(--primary-dark);
            font-size: 1.2rem;
            margin: 1rem 0;
        }

        /* Feedback and Result Box */
        .feedback-box, .result-box {
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
            font-weight: 500;
            min-height: 50px;
            background: #eef2ff;
            color: var(--primary-dark);
            text-align: center;
            transition: background-color 0.3s, color 0.3s;
        }
        
        .result-box {
            font-weight: bold;
            font-size: 1.1rem;
            background-color: #ecfdf5;
            color: #065f46;
        }
        .question-box {
             background-color: #fffbeb;
             border: 1px solid #fde68a;
             padding: 1rem;
             margin-top: 1.5rem;
             border-radius: 0.75rem;
        }
        .question-box p {
             margin-bottom: 0.5rem;
             font-weight: 600;
        }


        /* Slider */
        .slider-container {
            padding-top: 1rem;
        }
        .slider-container label {
            font-weight: 600;
            color: var(--primary-dark);
        }
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            margin: 10px 0;
            background: transparent;
        }
        input[type=range]:focus { outline: none; }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 8px; cursor: pointer; background: #c7d2fe; border-radius: 4px;
        }
        input[type=range]::-webkit-slider-thumb {
            height: 24px; width: 24px; border-radius: 50%; background: var(--primary-color); cursor: pointer;
            -webkit-appearance: none; margin-top: -8px; box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }

        /* Canvas Panel */
        .canvas-panel {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            height: 100%;
        }
        #graphCanvas, #graphCanvas2, #graphCanvas3, #graphCanvas4 {
            background-color: var(--white);
            border-radius: 0.75rem;
            max-width: 100%;
            max-height: 100%;
        }
        
        #graphCanvas.plotting-active, #graphCanvas2.plotting-active, #graphCanvas3.plotting-active, #graphCanvas4.plotting-active {
            cursor: none;
        }
        
        #plot-tool-activator, #plot-tool-activator2, #plot-tool-activator3, #plot-tool-activator4 {
            text-align: center;
            margin-top: 1rem;
            background-color: #eef2ff;
            padding: 0.5rem;
            border-radius: 0.75rem;
            border: 2px dashed var(--primary-color);
            cursor: pointer;
            transition: background-color 0.2s;
            -webkit-tap-highlight-color: transparent;
        }
        #plot-tool-activator:hover, #plot-tool-activator2:hover, #plot-tool-activator3:hover, #plot-tool-activator4:hover {
            background-color: #e0e7ff;
        }
        #activatorFinger, #activatorFinger2, #activatorFinger3, #activatorFinger4 {
            font-size: 2.5rem;
            user-select: none;
        }

        .app-footer {
            text-align: center;
            padding: 1.5rem;
            color: var(--text-light);
            font-size: 0.9rem;
            background-color: var(--white);
            border-top: 1px solid var(--border-color);
            margin-top: auto;
            font-weight: bold;
        }

        /* Responsive Styles */
        @media (min-width: 768px) {
            .card-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (min-width: 1024px) {
            .simulation-grid {
                grid-template-columns: 400px 1fr;
            }
        }

    </style>
</head>
<body>

    <div class="app-container">
        <header class="app-header">
            <h1 id="headerTitle">கன்ய சம்பூர்ணா திட்டம்/கன்யா பெண்கள் கல்வி திட்டம்</h1>
            <p style="font-weight: 600; font-size: clamp(0.9rem, 2.5vw, 1.2rem);">இத்திட்டம் TITAN மற்றும் KALIKE நிறுவனங்களின் பங்களிப்புடன் செயல்படுத்தப்படுகிறது</p>
            <p style="font-size: clamp(1.2rem, 3.5vw, 1.75rem); font-weight: 600; margin-top: 0.5rem;">பத்தாம் வகுப்பு - கணிதம்</p>
        </header>

        <main id="mainContent">
            <!-- Home Screen -->
            <div id="homeScreen">
                <div class="card-grid">
                    <div id="graphButton" class="card">
                        <h2>வரைபடங்கள்</h2>
                    </div>
                    <div class="card disabled">
                        <h2>வடிவியல்</h2>
                        <p>(விரைவில் வருகிறது)</p>
                    </div>
                </div>
            </div>

            <!-- Simulation Screen -->
            <div id="simulationScreen" class="hidden">
                 <div class="tab-container">
                    <button class="tab-btn active" data-tab="model1">மாதிரி 1</button>
                    <button class="tab-btn" data-tab="model2">மாதிரி 2</button>
                    <button class="tab-btn" data-tab="model3">மாதிரி 3</button>
                    <button class="tab-btn" data-tab="model4">மாதிரி 4</button>
                </div>
                <!-- Model 1 Content -->
                <div id="model1" class="tab-content active">
                    <div class="simulation-grid">
                        <div class="controls-panel panel">
                            <h2>கணக்கு</h2>
                            <p>
                                <b>வர்ஷிகா வெவ்வேறு அளவுகளில் 6 வட்டங்களை வரைந்தாள். அட்டவணையில் உள்ளவாறு, ஒவ்வொரு வட்டத்தின் விட்டத்திற்கும் அதன் சுற்றளவிற்கும் உள்ள தோராயத் தொடர்புக்கு ஒரு வரைபடம் வரையவும். அதனைப் பயன்படுத்தி, விட்டமானது 6 செ.மீ ஆக இருக்கும்போது வட்டத்தின் சுற்றளவைக் காண்க.</b>
                            </p>
                            
                            <p class="formula"><b>சூத்திரம்: சுற்றளவு ≈ π × விட்டம்</b></p>

                            <div class="input-group">
                                <input type="number" id="xInput" placeholder="விட்டம் (x)">
                                <button id="addPointBtn" class="btn btn-secondary">சேர்க்க</button>
                            </div>

                            <table class="data-table">
                                <thead>
                                    <tr><th>விட்டம் (x)</th><th>சுற்றளவு (y)</th></tr>
                                </thead>
                                <tbody id="dataTableBody">
                                    <!-- Data points will be populated by script -->
                                </tbody>
                            </table>
                            
                            <div id="plot-tool-activator" class="hidden">
                                <div id="activatorFinger">👆</div>
                                <span>புள்ளியைக் குறிக்க இதை அழுத்தவும்</span>
                            </div>

                            <div class="btn-group">
                                <button id="plotBtn" class="btn btn-primary" disabled>1. புள்ளிகளைக் குறிக்கவும்</button>
                                <button id="lineBtn" class="btn btn-primary" disabled>2. நேர்க்கோடு வரையவும்</button>
                                
                                <div id="sliderSection" class="slider-container hidden">
                                    <label for="diameterSlider">3. விட்டத்தை தேர்வு செய்யவும்: <span id="sliderValue" style="font-size: 1.25rem; font-weight: bold;">6</span> செ.மீ</label>
                                    <input type="range" id="diameterSlider" min="1" max="10" value="6" step="0.5">
                                </div>
                                 <div id="resultBox" class="result-box hidden"></div>
                            </div>

                            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                                <button id="resetBtn" class="btn btn-secondary" style="flex: 1;">மீட்டமை</button>
                                <button id="backBtn" class="btn btn-secondary" style="flex: 1; background-color: #ef4444;">பின் செல்</button>
                            </div>
                            <div class="feedback-box" id="feedbackBox">
                                வழிமுறைகளுக்கு இங்கே பார்க்கவும்.
                            </div>
                        </div>

                        <div class="canvas-panel panel">
                            <canvas id="graphCanvas"></canvas>
                        </div>
                    </div>
                </div>
                 <!-- Model 2 Content -->
                <div id="model2" class="tab-content">
                    <div class="simulation-grid">
                         <div class="controls-panel panel">
                            <h2>கணக்கு</h2>
                            <p>
                                <b>ஒரு பேருந்து 50 கி.மீ/மணி என்ற சீரான வேகத்தில் பயணிக்கிறது. இத்தொடர்புக்கான தூரம் – நேரம் வரைபடம் வரைந்து, பின்வருவனவற்றைக் காண்க.</b>
                            </p>
                             <ul style="padding-left: 20px; margin-bottom: 1rem;">
                                 <li><b>(i) விகிதசம மாறிலியைக் காண்க</b></li>
                                 <li><b>(ii) 90 நிமிடங்களில் பயணிக்கும் தூரம் எவ்வளவு?</b></li>
                                 <li><b>(iii) 300 கி.மீ. தூரத்தை பயணிக்க எவ்வளவு நேரம் ஆகும்?</b></li>
                             </ul>
                            
                            <p class="formula"><b>சூத்திரம்: y = kx</b></p>

                             <div class="input-group">
                                 <input type="number" id="xInput2" placeholder="நேரம் (நிமிடங்களில்)">
                                 <button id="addPointBtn2" class="btn btn-secondary">சேர்க்க</button>
                             </div>

                            <table class="data-table">
                                <thead>
                                    <tr><th>பயண நேரம் (x) நிமிடங்கள்</th><th>பயண தூரம் (y) கி.மீ-ல்</th></tr>
                                </thead>
                                <tbody id="dataTableBody2"></tbody>
                            </table>
                            
                            <div id="plot-tool-activator2" class="hidden">
                                <div id="activatorFinger2">👆</div>
                                <span>புள்ளியைக் குறிக்க இதை அழுத்தவும்</span>
                            </div>

                            <div class="btn-group">
                                <button id="plotBtn2" class="btn btn-primary" disabled>1. புள்ளிகளைக் குறிக்கவும்</button>
                                <button id="lineBtn2" class="btn btn-primary" disabled>2. நேர்க்கோடு வரையவும்</button>
                            </div>
                            
                             <div id="questionsSection2" class="hidden">
                                 <div class="question-box">
                                     <p>(i) விகிதசம மாறிலி (k):</p>
                                     <div id="resultBox2_k" class="result-box" style="margin-top: 0;"></div>
                                 </div>
                                <div class="question-box">
                                     <p>(ii) 90 நிமிடங்களில் பயணிக்கும் தூரம்:</p>
                                     <div id="sliderSection2_dist" class="slider-container">
                                         <label for="timeSlider">நேரத்தை தேர்வு செய்யவும்: <span id="sliderValue2_time">90</span> நிமிடங்கள்</label>
                                         <input type="range" id="timeSlider" min="0" max="360" value="90" step="10">
                                     </div>
                                    <div id="resultBox2_dist" class="result-box"></div>
                                </div>
                                 <div class="question-box">
                                     <p>(iii) 300 கி.மீ. பயணிக்க ஆகும் நேரம்:</p>
                                     <div id="sliderSection2_time" class="slider-container">
                                         <label for="distSlider">தூரத்தை தேர்வு செய்யவும்: <span id="sliderValue2_dist">300</span> கி.மீ</label>
                                         <input type="range" id="distSlider" min="0" max="350" value="300" step="10">
                                     </div>
                                     <div id="resultBox2_time" class="result-box"></div>
                                 </div>
                             </div>


                            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                                <button id="resetBtn2" class="btn btn-secondary" style="flex: 1;">மீட்டமை</button>
                                <button id="backBtn2" class="btn btn-secondary" style="flex: 1; background-color: #ef4444;">பின் செல்</button>
                            </div>
                            <div class="feedback-box" id="feedbackBox2">
                                வழிமுறைகளுக்கு இங்கே பார்க்கவும்.
                            </div>
                        </div>
                        <div class="canvas-panel panel">
                            <canvas id="graphCanvas2"></canvas>
                        </div>
                    </div>
                </div>
                <!-- Model 3 Content -->
                <div id="model3" class="tab-content">
                    <div class="simulation-grid">
                         <div class="controls-panel panel">
                            <h2>கணக்கு</h2>
                            <p>
                                <b>ஒரு நிறுவனமானது தொடக்கத்தில் 40 வேலையாட்களுடன் 150 நாட்களில் ஒரு வேலையை முடிக்கத் தொடங்கியது. பிறகு, வேலையை விரைவாக முடித்திட வேலையாள்களை அதிகரித்தது.</b>
                            </p>
                             <ul style="padding-left: 20px; margin-bottom: 1rem;">
                                 <li><b>(i) மேலே கொடுக்கப்பட்டுள்ள தரவுகளுக்கு வரைபடம் வரைந்து மாறுபாட்டின் வகையை அடையாளம் காண்க.</b></li>
                                 <li><b>(ii) 120 வேலையாள்களை வேலைக்கு அமர்த்தினால், வேலை முடிய எத்தனை நாட்கள் ஆகும்?</b></li>
                                 <li><b>(iii) வேலையானது 200 நாட்களில் முடிய வேண்டும் எனில், எத்தனை வேலையாட்கள் தேவை?</b></li>
                             </ul>
                            
                            <p class="formula"><b>சூத்திரம்: xy = k (எதிர் மாறுபாடு)</b></p>

                            <div class="input-group">
                                <input type="number" id="xInput3" placeholder="வேலையாட்கள் (x)">
                                <button id="addPointBtn3" class="btn btn-secondary">சேர்க்க</button>
                            </div>

                            <table class="data-table">
                                <thead>
                                    <tr><th>வேலையாட்கள் (x)</th><th>நாட்கள் (y)</th></tr>
                                </thead>
                                <tbody id="dataTableBody3"></tbody>
                            </table>
                            
                            <div id="plot-tool-activator3" class="hidden">
                                <div id="activatorFinger3">👆</div>
                                <span>புள்ளியைக் குறிக்க இதை அழுத்தவும்</span>
                            </div>

                            <div class="btn-group">
                                <button id="plotBtn3" class="btn btn-primary" disabled>1. புள்ளிகளைக் குறிக்கவும்</button>
                                <button id="lineBtn3" class="btn btn-primary" disabled>2. வளைகோடு வரையவும்</button>
                            </div>
                            
                             <div id="questionsSection3" class="hidden">
                                 <div class="question-box">
                                     <p>(i) மாறுபாட்டின் வகை:</p>
                                     <div id="resultBox3_k" class="result-box" style="margin-top: 0;"></div>
                                 </div>
                                <div class="question-box">
                                     <p>(ii) 120 வேலையாட்கள் எனில், தேவைப்படும் நாட்கள்:</p>
                                     <div class="slider-container">
                                         <label for="workersSlider3">வேலையாட்களை தேர்வு செய்யவும்: <span id="sliderValue3_workers">120</span></label>
                                         <input type="range" id="workersSlider3" min="20" max="200" value="120" step="5">
                                     </div>
                                    <div id="resultBox3_days" class="result-box"></div>
                                </div>
                                 <div class="question-box">
                                     <p>(iii) 200 நாட்களில் முடிக்க, தேவைப்படும் வேலையாட்கள்:</p>
                                     <div class="slider-container">
                                         <label for="daysSlider3">நாட்களை தேர்வு செய்யவும்: <span id="sliderValue3_days">200</span></label>
                                         <input type="range" id="daysSlider3" min="20" max="300" value="200" step="5">
                                     </div>
                                     <div id="resultBox3_workers" class="result-box"></div>
                                 </div>
                             </div>


                            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                                <button id="resetBtn3" class="btn btn-secondary" style="flex: 1;">மீட்டமை</button>
                                <button id="backBtn3" class="btn btn-secondary" style="flex: 1; background-color: #ef4444;">பின் செல்</button>
                            </div>
                            <div class="feedback-box" id="feedbackBox3">
                                வழிமுறைகளுக்கு இங்கே பார்க்கவும்.
                            </div>
                        </div>
                        <div class="canvas-panel panel">
                            <canvas id="graphCanvas3"></canvas>
                        </div>
                    </div>
                </div>
                <!-- Model 4 Content -->
                <div id="model4" class="tab-content">
                    <div class="simulation-grid">
                         <div class="controls-panel panel">
                            <h2>கணக்கு</h2>
                            <p>
                                <b>xy = 24, x, y > 0 என்ற வரைபடத்தை வரைக. வரைபடத்தைப் பயன்படுத்தி, (i) x = 3 எனில் y - ஐக் காண்க மற்றும் (ii) y = 6 எனில் x - ஐக் காண்க.</b>
                            </p>
                            
                            <p class="formula"><b>சூத்திரம்: xy = 24 (எதிர் மாறுபாடு)</b></p>

                            <div class="input-group">
                                <input type="number" id="xInput4" placeholder="x மதிப்பு">
                                <button id="addPointBtn4" class="btn btn-secondary">சேர்க்க</button>
                            </div>

                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>x</th>
                                        <th> </th>
                                        <th>y</th>
                                        <th> </th>
                                        <th>k</th>
                                    </tr>
                                </thead>
                                <tbody id="dataTableBody4"></tbody>
                            </table>
                            
                            <div id="plot-tool-activator4" class="hidden">
                                <div id="activatorFinger4">👆</div>
                                <span>புள்ளியைக் குறிக்க இதை அழுத்தவும்</span>
                            </div>

                            <div class="btn-group">
                                <button id="generatePointsBtn4" class="btn btn-primary" disabled>புள்ளிகளை உருவாக்கவும் (x, y)</button>
                                <div id="coordinatesDisplay4" class="feedback-box hidden" style="margin-top: 1rem; background-color: #f3f4f6; color: #1f2937;"></div>
                                <button id="plotBtn4" class="btn btn-primary" disabled>1. புள்ளிகளைக் குறிக்கவும்</button>
                                <button id="lineBtn4" class="btn btn-primary" disabled>2. வளைகோடு வரையவும்</button>
                            </div>
                            
                             <div id="questionsSection4" class="hidden">
                                <div class="question-box">
                                     <p>(i) x = 3 எனில், y-ன் மதிப்பு:</p>
                                     <div class="slider-container">
                                         <label for="xSlider4">x-ஐ தேர்வு செய்யவும்: <span id="sliderValue4_x">3</span></label>
                                         <input type="range" id="xSlider4" min="1" max="24" value="3" step="1">
                                     </div>
                                    <div id="resultBox4_y" class="result-box"></div>
                                </div>
                                 <div class="question-box">
                                     <p>(ii) y = 6 எனில், x-ன் மதிப்பு:</p>
                                     <div class="slider-container">
                                         <label for="ySlider4">y-ஐ தேர்வு செய்யவும்: <span id="sliderValue4_y">6</span></label>
                                         <input type="range" id="ySlider4" min="1" max="24" value="6" step="1">
                                     </div>
                                     <div id="resultBox4_x" class="result-box"></div>
                                 </div>
                             </div>


                            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                                <button id="resetBtn4" class="btn btn-secondary" style="flex: 1;">மீட்டமை</button>
                                <button id="backBtn4" class="btn btn-secondary" style="flex: 1; background-color: #ef4444;">பின் செல்</button>
                            </div>
                            <div class="feedback-box" id="feedbackBox4">
                                வழிமுறைகளுக்கு இங்கே பார்க்கவும்.
                            </div>
                        </div>
                        <div class="canvas-panel panel">
                            <canvas id="graphCanvas4"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        <footer class="app-footer">
            <p>Powered by Artificial Intelligence, this simulation has been created by Kalike, an associate organization of Tata Trusts.</p>
        </footer>
    </div>

<script>
    // --- COMMON ---
    const homeScreen = document.getElementById('homeScreen');
    const simulationScreen = document.getElementById('simulationScreen');
    const graphButton = document.getElementById('graphButton');
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    const headerTitle = document.getElementById('headerTitle');

    // --- MODEL 1 ELEMENTS ---
    const backBtn = document.getElementById('backBtn');
    const canvas = document.getElementById('graphCanvas');
    const ctx = canvas.getContext('2d');
    const plotBtn = document.getElementById('plotBtn');
    const lineBtn = document.getElementById('lineBtn');
    const sliderSection = document.getElementById('sliderSection');
    const diameterSlider = document.getElementById('diameterSlider');
    const sliderValue = document.getElementById('sliderValue');
    const resultBox = document.getElementById('resultBox');
    const resetBtn = document.getElementById('resetBtn');
    const feedbackBox = document.getElementById('feedbackBox');
    const xInput = document.getElementById('xInput');
    const addPointBtn = document.getElementById('addPointBtn');
    const dataTableBody = document.getElementById('dataTableBody');
    const plotToolActivator = document.getElementById('plot-tool-activator');
    let activatorFinger = document.getElementById('activatorFinger');

    // --- MODEL 2 ELEMENTS ---
    const backBtn2 = document.getElementById('backBtn2');
    const canvas2 = document.getElementById('graphCanvas2');
    const ctx2 = canvas2.getContext('2d');
    const plotBtn2 = document.getElementById('plotBtn2');
    const lineBtn2 = document.getElementById('lineBtn2');
    const questionsSection2 = document.getElementById('questionsSection2');
    const timeSlider = document.getElementById('timeSlider');
    const sliderValue2_time = document.getElementById('sliderValue2_time');
    const resultBox2_dist = document.getElementById('resultBox2_dist');
    const distSlider = document.getElementById('distSlider');
    const sliderValue2_dist = document.getElementById('sliderValue2_dist');
    const resultBox2_time = document.getElementById('resultBox2_time');
    const resultBox2_k = document.getElementById('resultBox2_k');
    const resetBtn2 = document.getElementById('resetBtn2');
    const feedbackBox2 = document.getElementById('feedbackBox2');
    const xInput2 = document.getElementById('xInput2');
    const addPointBtn2 = document.getElementById('addPointBtn2');
    const dataTableBody2 = document.getElementById('dataTableBody2');
    const plotToolActivator2 = document.getElementById('plot-tool-activator2');
    let activatorFinger2 = document.getElementById('activatorFinger2');
    
    // --- MODEL 3 ELEMENTS ---
    const backBtn3 = document.getElementById('backBtn3');
    const canvas3 = document.getElementById('graphCanvas3');
    const ctx3 = canvas3.getContext('2d');
    const plotBtn3 = document.getElementById('plotBtn3');
    const lineBtn3 = document.getElementById('lineBtn3');
    const questionsSection3 = document.getElementById('questionsSection3');
    const workersSlider3 = document.getElementById('workersSlider3');
    const sliderValue3_workers = document.getElementById('sliderValue3_workers');
    const resultBox3_days = document.getElementById('resultBox3_days');
    const daysSlider3 = document.getElementById('daysSlider3');
    const sliderValue3_days = document.getElementById('sliderValue3_days');
    const resultBox3_workers = document.getElementById('resultBox3_workers');
    const resultBox3_k = document.getElementById('resultBox3_k');
    const resetBtn3 = document.getElementById('resetBtn3');
    const feedbackBox3 = document.getElementById('feedbackBox3');
    const dataTableBody3 = document.getElementById('dataTableBody3');
    const plotToolActivator3 = document.getElementById('plot-tool-activator3');
    const xInput3 = document.getElementById('xInput3');
    const addPointBtn3 = document.getElementById('addPointBtn3');
    let activatorFinger3 = document.getElementById('activatorFinger3');
    
    // --- MODEL 4 ELEMENTS ---
    const backBtn4 = document.getElementById('backBtn4');
    const canvas4 = document.getElementById('graphCanvas4');
    const ctx4 = canvas4.getContext('2d');
    const plotBtn4 = document.getElementById('plotBtn4');
    const lineBtn4 = document.getElementById('lineBtn4');
    const generatePointsBtn4 = document.getElementById('generatePointsBtn4');
    const questionsSection4 = document.getElementById('questionsSection4');
    const xSlider4 = document.getElementById('xSlider4');
    const sliderValue4_x = document.getElementById('sliderValue4_x');
    const resultBox4_y = document.getElementById('resultBox4_y');
    const ySlider4 = document.getElementById('ySlider4');
    const sliderValue4_y = document.getElementById('sliderValue4_y');
    const resultBox4_x = document.getElementById('resultBox4_x');
    const resetBtn4 = document.getElementById('resetBtn4');
    const feedbackBox4 = document.getElementById('feedbackBox4');
    const dataTableBody4 = document.getElementById('dataTableBody4');
    const plotToolActivator4 = document.getElementById('plot-tool-activator4');
    const xInput4 = document.getElementById('xInput4');
    const addPointBtn4 = document.getElementById('addPointBtn4');
    const coordinatesDisplay4 = document.getElementById('coordinatesDisplay4');
    let activatorFinger4 = document.getElementById('activatorFinger4');


    // --- MODEL 1 STATE ---
    let data = [];
    let pointsPlotted = false;
    let lineDrawn = false;
    let graphDrawn = false;
    let plottingMode = false;
    let currentPointIndex = 0;
    let userPlottedPoints = [];
    let mouseCanvasPos = { x: -1, y: -1 };
    let snappedGraphPos = { x: -1, y: -1 };
    let isNearTarget = false;
    let isToolActive = false;
    let padding = 60;
    let maxX = 10, maxY = 31;
    let xScale, yScale;
    
    // --- MODEL 2 STATE ---
    let data2 = [];
    let pointsPlotted2 = false;
    let lineDrawn2 = false;
    let graphDrawn2 = false;
    let plottingMode2 = false;
    let currentPointIndex2 = 0;
    let userPlottedPoints2 = [];
    let mouseCanvasPos2 = { x: -1, y: -1 };
    let snappedGraphPos2 = { x: -1, y: -1 };
    let isNearTarget2 = false;
    let isToolActive2 = false;
    let padding2 = 60;
    let maxX2 = 360, maxY2 = 350;
    let xScale2, yScale2;
    const proportionalityConstant = 5 / 6; // 50km per 60 mins

    // --- MODEL 3 STATE ---
    let data3 = [];
    let pointsPlotted3 = false;
    let lineDrawn3 = false;
    let graphDrawn3 = false;
    let plottingMode3 = false;
    let currentPointIndex3 = 0;
    let userPlottedPoints3 = [];
    let mouseCanvasPos3 = { x: -1, y: -1 };
    let snappedGraphPos3 = { x: -1, y: -1 };
    let isNearTarget3 = false;
    let isToolActive3 = false;
    let padding3 = 60;
    let maxX3 = 200, maxY3 = 300;
    let xScale3, yScale3;
    const inverseConstant = 6000; // 40 workers * 150 days

    // --- MODEL 4 STATE ---
    let data4 = [];
    let pointsPlotted4 = false;
    let lineDrawn4 = false;
    let graphDrawn4 = false;
    let plottingMode4 = false;
    let currentPointIndex4 = 0;
    let userPlottedPoints4 = [];
    let mouseCanvasPos4 = { x: -1, y: -1 };
    let snappedGraphPos4 = { x: -1, y: -1 };
    let isNearTarget4 = false;
    let isToolActive4 = false;
    let padding4 = 60;
    let maxX4 = 25, maxY4 = 25;
    let xScale4, yScale4;
    const inverseConstant4 = 24;

    // --- EVENT HANDLER REFERENCES ---
    let plotMoveHandler1, touchMoveHandler1, plotClickHandler1;
    let plotMoveHandler2, touchMoveHandler2, plotClickHandler2;
    let plotMoveHandler3, touchMoveHandler3, plotClickHandler3;
    let plotMoveHandler4, touchMoveHandler4, plotClickHandler4;

    // --- GENERAL FUNCTIONS ---

    function switchTab(targetTabId) {
        tabContents.forEach(content => content.classList.remove('active'));
        tabBtns.forEach(btn => btn.classList.remove('active'));

        document.getElementById(targetTabId).classList.add('active');
        document.querySelector(`.tab-btn[data-tab="${targetTabId}"]`).classList.add('active');

        if (targetTabId === 'model1') {
            resizeCanvas();
        } else if (targetTabId === 'model2') {
            if (data2.length === 0 && !plottingMode2) {
                initModel2();
            }
            resizeCanvas2();
        } else if (targetTabId === 'model3') {
            if (data3.length === 0 && !plottingMode3) {
                initModel3();
            }
            resizeCanvas3();
        } else if (targetTabId === 'model4') {
            if (data4.length === 0 && !plottingMode4) {
                initModel4();
            }
            resizeCanvas4();
        }
    }
    
    window.addEventListener('resize', () => {
        const activeTab = document.querySelector('.tab-content.active').id;
        if (activeTab === 'model1') resizeCanvas();
        else if (activeTab === 'model2') resizeCanvas2();
        else if (activeTab === 'model3') resizeCanvas3();
        else if (activeTab === 'model4') resizeCanvas4();
    });

    // --- MODEL 1: CIRCLE SIMULATION ---

    function resizeCanvas() {
        const container = canvas.parentElement;
        const size = Math.min(container.clientWidth - 20, container.clientHeight - 20, 800);
        canvas.width = size;
        canvas.height = size;
        if (graphDrawn) {
            updateGraphBounds();
            drawGraph();
        } else {
             clearCanvas();
        }
    }
    
    function clearCanvas(){
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#6b7280';
        ctx.font = 'bold 16px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('முதலில் விட்டத்தின் மதிப்புகளை உள்ளிடவும்', canvas.width / 2, canvas.height / 2);
    }
    
    function updateGraphBounds() {
        if (data.length === 0) return;
        const maxD = data.reduce((max, p) => Math.max(max, p.d), 0);
        const maxC = data.reduce((max, p) => Math.max(max, p.c), 0);
        maxX = Math.max(10, Math.ceil((maxD + 2)));
        maxY = Math.max(20, Math.ceil((maxC + 5)));
        xScale = (canvas.width - 2 * padding) / maxX;
        yScale = (canvas.height - 2 * padding) / maxY;
        diameterSlider.max = maxX;
    }

    function drawGraph() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        if (!graphDrawn) {
            clearCanvas();
            return;
        }
        
        // Draw Scale Text
        ctx.fillStyle = '#1f293b';
        ctx.font = 'bold 13px sans-serif';
        ctx.textAlign = 'right';
        ctx.fillText('அளவுத்திட்டம்:', canvas.width - 20, padding - 15);
        ctx.font = '13px sans-serif';
        ctx.fillText('X-அச்சு: 1 செ.மீ = 1 அலகு', canvas.width - 20, padding + 5);
        ctx.fillText('Y-அச்சு: 1 செ.மீ = 2 அலகுகள்', canvas.width - 20, padding + 25);

        // Draw Axes
        ctx.beginPath();
        ctx.moveTo(padding, padding);
        ctx.lineTo(padding, canvas.height - padding);
        ctx.lineTo(canvas.width - padding, canvas.height - padding);
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        ctx.stroke();

        drawArrow(ctx, canvas.width - padding, canvas.height - padding, true);
        drawArrow(ctx, padding, padding, false);

        // Labels
        ctx.fillStyle = '#1e293b';
        ctx.font = 'bold 16px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('விட்டம் (x) (செ.மீ)', canvas.width / 2, canvas.height - 15);
        ctx.save();
        ctx.translate(20, canvas.height / 2);
        ctx.rotate(-Math.PI / 2);
        ctx.fillText('சுற்றளவு (y) (செ.மீ)', 0, 0);
        ctx.restore();

        // Ticks, Gridlines, and Labels
        ctx.font = 'bold 12px sans-serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'top';

        for (let i = 0; i <= maxX; i += 1) {
            const x = padding + i * xScale;
            ctx.fillStyle = '#1e293b';
            ctx.fillText(i, x, canvas.height - padding + 10);
            if (i > 0) {
                ctx.beginPath();
                ctx.moveTo(x, canvas.height - padding);
                ctx.lineTo(x, padding);
                ctx.lineWidth = 1;
                ctx.strokeStyle = '#e2e8f0';
                ctx.stroke();
            }
        }
        
        ctx.textAlign = 'right';
        ctx.textBaseline = 'middle';
        for (let i = 0; i <= maxY; i += 1) {
             const y = canvas.height - padding - i * yScale;
             if (i > 0 && i % 2 === 0) { // Label every 2 units for clarity
                 ctx.fillStyle = '#1e293b';
                 ctx.fillText(i, padding - 10, y);
             }
             if (i > 0) {
                 ctx.beginPath();
                 ctx.moveTo(padding, y);
                 ctx.lineTo(canvas.width - padding, y);
                 ctx.lineWidth = 1;
                 ctx.strokeStyle = '#e2e8f0';
                 ctx.stroke();
             }
        }
        
        userPlottedPoints.forEach(p => drawPoint(p.d, p.c, '#4f46e5', 8));
        
        // Draw permanent coordinate labels for correctly plotted points in Model 1
        ctx.font = 'bold 14px sans-serif';
        ctx.fillStyle = '#1e293b';
        ctx.textAlign = 'left';
        ctx.textBaseline = 'bottom';
        userPlottedPoints.forEach(p => {
            const xPos = padding + p.d * xScale;
            const yPos = canvas.height - padding - p.c * yScale;
            const coordText = `(${p.d}, ${p.c})`;
            ctx.fillText(coordText, xPos + 10, yPos - 10);
        });

        if (isToolActive && mouseCanvasPos.x > 0 && mouseCanvasPos.y > 0) {
            ctx.textAlign = 'center';
            ctx.textBaseline = 'top';
            
            ctx.font = '32px sans-serif';
            ctx.fillStyle = isNearTarget ? '#10b981' : '#ef4444';
            ctx.fillText('👆', mouseCanvasPos.x, mouseCanvasPos.y);

            const coordText = `(${snappedGraphPos.x.toFixed(1)}, ${snappedGraphPos.y.toFixed(1)})`;
            
            ctx.font = 'bold 20px monospace';
            ctx.textAlign = 'left';
            ctx.textBaseline = 'middle';
            const textMetrics = ctx.measureText(coordText);
            
            const tailXBase = mouseCanvasPos.x;
            const tailY = mouseCanvasPos.y + 15;
            let rectX, textX;

            // Position tooltip to the right by default
            rectX = tailXBase + 20;
            textX = rectX + 5;

            // If it overflows right, position to the left
            if (rectX + textMetrics.width + 10 > canvas.width) {
                rectX = tailXBase - 20 - textMetrics.width - 10;
                textX = rectX + 5;
            }

            ctx.fillStyle = isNearTarget ? 'rgba(16, 185, 129, 0.9)' : 'rgba(30, 41, 59, 0.8)';
            ctx.beginPath();
            ctx.roundRect(rectX, tailY - 14, textMetrics.width + 10, 28, 7);
            ctx.fill();
            
            ctx.fillStyle = '#ffffff';
            ctx.fillText(coordText, textX, tailY);
            
            ctx.textAlign = 'center';
            ctx.textBaseline = 'alphabetic';
            ctx.fillStyle = '#1e293b';
        }

        if (lineDrawn) {
            drawLine();
            diameterSlider.dispatchEvent(new Event('input'));
        }
    }
    
    function drawArrow(ctx, x, y, isHorizontal) {
        ctx.beginPath();
        if (isHorizontal) {
            ctx.moveTo(x, y); ctx.lineTo(x - 10, y - 5); ctx.lineTo(x - 10, y + 5);
        } else {
            ctx.moveTo(x, y); ctx.lineTo(x - 5, y + 10); ctx.lineTo(x + 5, y + 10);
        }
        ctx.closePath(); ctx.fillStyle = '#333'; ctx.fill();
    }

    function drawPoint(d, c, color = '#4f46e5', radius = 6) {
        if (d > maxX || c > maxY) return;
        const x = padding + d * xScale;
        const y = canvas.height - padding - c * yScale;
        ctx.beginPath();
        ctx.arc(x, y, radius, 0, Math.PI * 2);
        ctx.fillStyle = color;
        ctx.fill();
        ctx.strokeStyle = 'white'; ctx.lineWidth = 2; ctx.stroke();
    }
    
    function startManualPlotting() {
        if (data.length < 5) {
            feedbackBox.textContent = 'தொடங்குவதற்கு முன் 5 புள்ளிகளைச் சேர்க்கவும்.';
            return;
        }

        graphDrawn = true;
        plottingMode = true;
        currentPointIndex = 0;
        userPlottedPoints = [];
        plotBtn.disabled = true;
        updateGraphBounds();
        drawGraph();
        
        plotToolActivator.classList.remove('hidden');
        activatorFinger.addEventListener('click', activatePlottingTool, { once: true });
        updateFeedbackForPlotting();
    }
    
    function activatePlottingTool() {
        isToolActive = true;
        document.body.classList.add('no-select');
        canvas.classList.add('plotting-active');
        plotToolActivator.classList.add('hidden');
        feedbackBox.innerHTML = `வரைபடத்தில் தொட்டு <b>(${data[currentPointIndex].d}, ${data[currentPointIndex].c})</b> என்ற புள்ளியைக் கண்டறியவும்.`;
        
        plotMoveHandler1 = (e) => plotMove(e, 1);
        touchMoveHandler1 = (e) => plotMove(e, 1);
        plotClickHandler1 = (e) => handlePlotClick(e, 1);

        document.addEventListener('mousemove', plotMoveHandler1);
        document.addEventListener('touchmove', touchMoveHandler1, { passive: false });
        document.addEventListener('click', plotClickHandler1);
    }

    function plotMove(e, model) {
        let currentCanvas, currentPadding, currentXScale, currentYScale, currentMaxX, currentMaxY;
        let currentSnappedPos, currentMousePos, currentTarget, snapValueX, snapValueY;

        if (model === 1) {
            if (!isToolActive) return;
            currentCanvas = canvas; currentPadding = padding;
            currentXScale = xScale; currentYScale = yScale;
            currentMaxX = maxX; currentMaxY = maxY;
            currentSnappedPos = snappedGraphPos; currentMousePos = mouseCanvasPos;
            currentTarget = data[currentPointIndex];
            snapValueX = 10; snapValueY = 10;
        } else if (model === 2) {
            if (!isToolActive2) return;
            currentCanvas = canvas2; currentPadding = padding2;
            currentXScale = xScale2; currentYScale = yScale2;
            currentMaxX = maxX2; currentMaxY = maxY2;
            currentSnappedPos = snappedGraphPos2; currentMousePos = mouseCanvasPos2;
            currentTarget = data2[currentPointIndex2];
            snapValueX = 1; snapValueY = 1;
        } else if (model === 3) { 
            if (!isToolActive3) return;
            currentCanvas = canvas3; currentPadding = padding3;
            currentXScale = xScale3; currentYScale = yScale3;
            currentMaxX = maxX3; currentMaxY = maxY3;
            currentSnappedPos = snappedGraphPos3; currentMousePos = mouseCanvasPos3;
            currentTarget = data3[currentPointIndex3];
            snapValueX = 1; snapValueY = 1; 
        } else { // model 4
             if (!isToolActive4) return;
            currentCanvas = canvas4; currentPadding = padding4;
            currentXScale = xScale4; currentYScale = yScale4;
            currentMaxX = maxX4; currentMaxY = maxY4;
            currentSnappedPos = snappedGraphPos4; currentMousePos = mouseCanvasPos4;
            currentTarget = data4[currentPointIndex4];
            snapValueX = 1; snapValueY = 1; 
        }

        e.preventDefault();
        const rect = currentCanvas.getBoundingClientRect();
        let clientX, clientY;
        if (e.touches && e.touches.length > 0) {
            clientX = e.touches[0].clientX; clientY = e.touches[0].clientY;
        } else {
            clientX = e.clientX; clientY = e.clientY;
        }
        
        const rawMouseX = clientX - rect.left;
        const rawMouseY = clientY - rect.top;
        let graphX = (rawMouseX - currentPadding) / currentXScale;
        let graphY = (currentCanvas.height - currentPadding - rawMouseY) / currentYScale;

        graphX = Math.max(0, Math.min(currentMaxX, graphX));
        graphY = Math.max(0, Math.min(currentMaxY, graphY));

        currentSnappedPos.x = parseFloat((Math.round(graphX * snapValueX) / snapValueX).toFixed(model === 1 ? 1 : 0));
        currentSnappedPos.y = parseFloat((Math.round(graphY * snapValueY) / snapValueY).toFixed(model === 1 ? 1 : 0));
        

        currentMousePos.x = currentPadding + currentSnappedPos.x * currentXScale;
        currentMousePos.y = currentCanvas.height - currentPadding - currentSnappedPos.y * currentYScale;
        
        let targetX, targetY;
        if (model === 1) targetX = currentTarget.d;
        else if (model === 2) targetX = currentTarget.t;
        else targetX = currentTarget.x;

        if (model === 1) targetY = currentTarget.c;
        else if (model === 2) targetY = currentTarget.d;
        else targetY = currentTarget.y;
        
        if (model === 1) {
            isNearTarget = (currentSnappedPos.x === targetX && currentSnappedPos.y === targetY);
            drawGraph();
        } else if (model === 2) {
            isNearTarget2 = (currentSnappedPos.x === targetX && currentSnappedPos.y === targetY);
            drawGraph2();
        } else if (model === 3){
            isNearTarget3 = (currentSnappedPos.x === targetX && currentSnappedPos.y === targetY);
            drawGraph3();
        } else {
            isNearTarget4 = (currentSnappedPos.x === targetX && currentSnappedPos.y === targetY);
            drawGraph4();
        }
    }
    
    function handlePlotClick(e, model) {
        let currentIsNearTarget;
        
        if (model === 1) {
            if (!isToolActive) return;
            currentIsNearTarget = isNearTarget;
        } else if (model === 2) {
            if (!isToolActive2) return;
            currentIsNearTarget = isNearTarget2;
        } else if (model === 3) {
            if (!isToolActive3) return;
            currentIsNearTarget = isNearTarget3;
        } else { // model 4
            if (!isToolActive4) return;
            currentIsNearTarget = isNearTarget4;
        }

        if (e.target.closest('.controls-panel')) return;
        e.preventDefault();
        
        if (currentIsNearTarget) {
            if (model === 1) {
                userPlottedPoints.push(data[currentPointIndex]);
                currentPointIndex++;

                if (currentPointIndex === 5 && data.length === 5) {
                    data.push({ d: 6, c: 18.6 });
                    updateTable(); 
                    updateGraphBounds();
                    updateFeedbackForPlotting();
                } else if (currentPointIndex >= data.length) {
                    plottingMode = false;
                    pointsPlotted = true;
                    lineBtn.disabled = false;
                    updateTable(); 
                    feedbackBox.textContent = 'அருமை! எல்லா புள்ளிகளும் குறிக்கப்பட்டன. இப்போது நேர்க்கோடு வரையவும்.';
                } else {
                    updateFeedbackForPlotting();
                }
            } else if (model === 2) {
                userPlottedPoints2.push(data2[currentPointIndex2]);
                currentPointIndex2++;
                if (currentPointIndex2 >= data2.length) {
                    plottingMode2 = false;
                    pointsPlotted2 = true;
                    lineBtn2.disabled = false;
                    feedbackBox2.textContent = 'அருமை! எல்லா புள்ளிகளும் குறிக்கப்பட்டன. இப்போது நேர்க்கோடு வரையவும்.';
                } else {
                    updateFeedbackForPlotting2();
                }
            } else if (model === 3) {
                userPlottedPoints3.push(data3[currentPointIndex3]);
                currentPointIndex3++;
                if (currentPointIndex3 >= data3.length) {
                    plottingMode3 = false;
                    pointsPlotted3 = true;
                    lineBtn3.disabled = false;
                    feedbackBox3.textContent = 'அருமை! எல்லா புள்ளிகளும் குறிக்கப்பட்டன. இப்போது வளைகோடு வரையவும்.';
                } else {
                    updateFeedbackForPlotting3();
                }
            } else { // model 4
                userPlottedPoints4.push(data4[currentPointIndex4]);
                currentPointIndex4++;
                if (currentPointIndex4 >= data4.length) {
                    plottingMode4 = false;
                    pointsPlotted4 = true;
                    lineBtn4.disabled = false;
                    feedbackBox4.textContent = 'அருமை! எல்லா புள்ளிகளும் குறிக்கப்பட்டன. இப்போது வளைகோடு வரையவும்.';
                } else {
                    updateFeedbackForPlotting4();
                }
            }
        } else {
            const fb = (model === 1) ? feedbackBox : (model === 2 ? feedbackBox2 : (model === 3 ? feedbackBox3 : feedbackBox4));
            fb.style.backgroundColor = '#fee2e2';
            fb.style.color = '#b91c1c';
            fb.textContent = 'தவறான இடம்! சரியான புள்ளியைக் கண்டறியவும்.';
            
            setTimeout(() => {
                fb.style.backgroundColor = '#eef2ff';
                fb.style.color = 'var(--primary-dark)';
                if (model === 1) updateFeedbackForPlotting();
                else if (model === 2) updateFeedbackForPlotting2();
                else if (model === 3) updateFeedbackForPlotting3();
                else updateFeedbackForPlotting4();
            }, 2000);
        }

        if (model === 1) {
            isToolActive = false;
            document.removeEventListener('mousemove', plotMoveHandler1);
            document.removeEventListener('touchmove', touchMoveHandler1);
            document.removeEventListener('click', plotClickHandler1);
            canvas.classList.remove('plotting-active');
            mouseCanvasPos = { x: -1, y: -1 };
            if (plottingMode && currentPointIndex < data.length) {
                plotToolActivator.classList.remove('hidden');
                activatorFinger.addEventListener('click', activatePlottingTool, { once: true });
            }
            drawGraph();
        } else if (model === 2) {
            isToolActive2 = false;
            document.removeEventListener('mousemove', plotMoveHandler2);
            document.removeEventListener('touchmove', touchMoveHandler2);
            document.removeEventListener('click', plotClickHandler2);
            canvas2.classList.remove('plotting-active');
            mouseCanvasPos2 = { x: -1, y: -1 };
            if (plottingMode2 && currentPointIndex2 < data2.length) {
                plotToolActivator2.classList.remove('hidden');
                activatorFinger2.addEventListener('click', activatePlottingTool2, { once: true });
            }
            drawGraph2();
        } else if (model === 3) {
             isToolActive3 = false;
            document.removeEventListener('mousemove', plotMoveHandler3);
            document.removeEventListener('touchmove', touchMoveHandler3);
            document.removeEventListener('click', plotClickHandler3);
            canvas3.classList.remove('plotting-active');
            mouseCanvasPos3 = { x: -1, y: -1 };
            if (plottingMode3 && currentPointIndex3 < data3.length) {
                plotToolActivator3.classList.remove('hidden');
                activatorFinger3.addEventListener('click', activatePlottingTool3, { once: true });
            }
            drawGraph3();
        } else { // model 4
             isToolActive4 = false;
            document.removeEventListener('mousemove', plotMoveHandler4);
            document.removeEventListener('touchmove', touchMoveHandler4);
            document.removeEventListener('click', plotClickHandler4);
            canvas4.classList.remove('plotting-active');
            mouseCanvasPos4 = { x: -1, y: -1 };
            if (plottingMode4 && currentPointIndex4 < data4.length) {
                plotToolActivator4.classList.remove('hidden');
                activatorFinger4.addEventListener('click', activatePlottingTool4, { once: true });
            }
            drawGraph4();
        }
        document.body.classList.remove('no-select');
    }
    
    function updateFeedbackForPlotting() {
        if (currentPointIndex < data.length) {
            const target = data[currentPointIndex];
            feedbackBox.innerHTML = `புள்ளி குறிக்கும் கருவியை அழுத்தி, வரைபடத்தில் <b>(${target.d}, ${target.c})</b> என்ற புள்ளியைக் கண்டறியவும்.`;
        }
    }
    
    function drawLine() {
        if (!pointsPlotted) return;
        
        const slope = 3.1;
        const startX = padding;
        const startY = canvas.height - padding;
        const endX = padding + maxX * xScale;
        const endY = canvas.height - padding - (maxX * slope) * yScale;
        
        ctx.beginPath();
        ctx.moveTo(startX, startY);
        ctx.lineTo(endX, endY);
        ctx.strokeStyle = '#ef4444';
        ctx.lineWidth = 3;
        ctx.stroke();
    }

    function handleSliderInput() {
        if (!lineDrawn) return;

        const slope = 3.1;
        const diameter = parseFloat(diameterSlider.value);
        sliderValue.textContent = diameter;
        const circumference = diameter * slope;
        
        drawGraph(); 

        const x = padding + diameter * xScale;
        const y = canvas.height - padding - circumference * yScale;
        
        ctx.beginPath();
        ctx.setLineDash([5, 5]);
        ctx.strokeStyle = '#10b981';
        ctx.lineWidth = 2;
        ctx.moveTo(x, canvas.height - padding);
        ctx.lineTo(x, y);
        ctx.lineTo(padding, y);
        ctx.stroke();
        ctx.setLineDash([]);

        drawPoint(diameter, circumference, '#10b981', 8);

        resultBox.textContent = `விட்டம் ${diameter} செ.மீ எனில், சுற்றளவு ≈ ${circumference.toFixed(1)} செ.மீ`;
    }

    function updateTable() {
        dataTableBody.innerHTML = '';
        data.forEach((point, index) => {
            const row = document.createElement('tr');
            const isFinalUnplottedPoint = (index === 5 && currentPointIndex < 6);
            const yValue = isFinalUnplottedPoint ? '?' : point.c;
            row.innerHTML = `<td>${point.d}</td><td>${yValue}</td>`;
            dataTableBody.appendChild(row);
        });
    }

    function resetSimulation() {
        data = [];
        pointsPlotted = lineDrawn = graphDrawn = plottingMode = isToolActive = isNearTarget = false;
        plotBtn.disabled = lineBtn.disabled = true;
        xInput.disabled = addPointBtn.disabled = false;
        xInput.value = '';
        sliderSection.classList.add('hidden');
        resultBox.classList.add('hidden');
        diameterSlider.value = 6;
        sliderValue.textContent = '6';
        updateTable();
        canvas.classList.remove('plotting-active');
        currentPointIndex = 0;
        userPlottedPoints = [];
        snappedGraphPos = { x: -1, y: -1 };
        plotToolActivator.classList.add('hidden');
        const newActivator = activatorFinger.cloneNode(true);
        activatorFinger.parentNode.replaceChild(newActivator, activatorFinger);
        activatorFinger = newActivator;
        feedbackBox.innerHTML = '<b>முதலில், 1 முதல் 5 வரை விட்டத்தின் மதிப்புகளை உள்ளிடவும்.</b>';
        resizeCanvas();
    }

    // --- MODEL 2: BUS SIMULATION ---

    function initModel2() {
        data2 = []; // Start with an empty array
        feedbackBox2.innerHTML = '<b>அட்டவணையை முடிக்க 4 நேர மதிப்புகளை (நிமிடங்களில்) உள்ளிடவும்.</b>';
        plotBtn2.disabled = true; // Disable plot button initially
        xInput2.disabled = false; // Enable input
        addPointBtn2.disabled = false; // Enable add button
        xInput2.value = '';
        updateTable2();
        resizeCanvas2();
    }

    function resizeCanvas2() {
        const container = canvas2.parentElement;
        const size = Math.min(container.clientWidth - 20, container.clientHeight - 20, 800);
        canvas2.width = size;
        canvas2.height = size;
        if (graphDrawn2) {
            updateGraphBounds2();
            drawGraph2();
        } else {
             clearCanvas2();
        }
    }

    function clearCanvas2() {
        ctx2.clearRect(0, 0, canvas2.width, canvas2.height);
        ctx2.fillStyle = '#6b7280';
        ctx2.font = 'bold 16px sans-serif';
        ctx2.textAlign = 'center';
        ctx2.fillText('நேர மதிப்புகளை உள்ளிடவும்', canvas2.width / 2, canvas2.height / 2);
    }

    function updateGraphBounds2() {
        maxX2 = 360; // max time in minutes
        maxY2 = 350; // max distance in km
        xScale2 = (canvas2.width - 2 * padding2) / maxX2;
        yScale2 = (canvas2.height - 2 * padding2) / maxY2;
        timeSlider.max = maxX2;
        distSlider.max = maxY2;
    }

    function drawGraph2() {
        ctx2.clearRect(0, 0, canvas2.width, canvas2.height);

        if (!graphDrawn2) {
            clearCanvas2();
            return;
        }

        // Draw Scale Text
        ctx2.fillStyle = '#1f293b';
        ctx2.font = 'bold 13px sans-serif';
        ctx2.textAlign = 'right';
        ctx2.fillText('அளவுத்திட்டம்:', canvas2.width - 20, padding2 - 15);
        ctx2.font = '13px sans-serif';
        ctx2.fillText('X-அச்சு: 1 செ.மீ = 30 அலகுகள்', canvas2.width - 20, padding2 + 5);
        ctx2.fillText('Y-அச்சு: 1 செ.மீ = 50 அலகுகள்', canvas2.width - 20, padding2 + 25);

        // Draw Axes
        ctx2.beginPath();
        ctx2.moveTo(padding2, padding2);
        ctx2.lineTo(padding2, canvas2.height - padding2);
        ctx2.lineTo(canvas2.width - padding2, canvas2.height - padding2);
        ctx2.strokeStyle = '#333';
        ctx2.lineWidth = 2;
        ctx2.stroke();
        drawArrow(ctx2, canvas2.width - padding2, canvas2.height - padding2, true);
        drawArrow(ctx2, padding2, padding2, false);

        // Labels
        ctx2.fillStyle = '#1e293b';
        ctx2.font = 'bold 16px sans-serif';
        ctx2.textAlign = 'center';
        ctx2.fillText('நேரம் (x) (நிமிடங்கள்)', canvas2.width / 2, canvas2.height - 15);
        ctx2.save();
        ctx2.translate(20, canvas2.height / 2);
        ctx2.rotate(-Math.PI / 2);
        ctx2.fillText('தூரம் (y) (கி.மீ)', 0, 0);
        ctx2.restore();

        // Ticks and Gridlines
        ctx2.font = 'bold 12px sans-serif';
        ctx2.textAlign = 'center';
        ctx2.textBaseline = 'top';

        // X-Axis
        for (let i = 0; i <= maxX2; i += 30) {
            const x = padding2 + i * xScale2;
            ctx2.fillStyle = '#1e293b';
            ctx2.fillText(i, x, canvas2.height - padding2 + 10);
            if (i > 0) {
                ctx2.beginPath();
                ctx2.moveTo(x, canvas2.height - padding2);
                ctx2.lineTo(x, padding2);
                ctx2.lineWidth = 1; ctx2.strokeStyle = '#e2e8f0'; ctx2.stroke();
            }
        }

        // Y-Axis
        ctx2.textAlign = 'right';
        ctx2.textBaseline = 'middle';
        for (let i = 0; i <= maxY2; i += 50) {
            const y = canvas2.height - padding2 - i * yScale2;
            if (i >= 0) {
                ctx2.fillStyle = '#1e293b';
                ctx2.fillText(i, padding2 - 10, y);
                if (i > 0) {
                  ctx2.beginPath();
                  ctx2.moveTo(padding2, y);
                  ctx2.lineTo(canvas2.width - padding2, y);
                  ctx2.lineWidth = 1; ctx2.strokeStyle = '#e2e8f0'; ctx2.stroke();
                }
            }
        }

        userPlottedPoints2.forEach(p => {
            drawPoint2(p.t, p.d, '#4f46e5', 8);
        });
        
        // Draw permanent coordinate labels for correctly plotted points
        ctx2.font = 'bold 14px sans-serif';
        ctx2.fillStyle = '#1e293b';
        ctx2.textAlign = 'left';
        ctx2.textBaseline = 'bottom';
        userPlottedPoints2.forEach(p => {
            const xPos = padding2 + p.t * xScale2;
            const yPos = canvas2.height - padding2 - p.d * yScale2;
            const coordText = `(${p.t}, ${p.d})`;
            ctx2.fillText(coordText, xPos + 10, yPos - 10);
        });


        if (isToolActive2 && mouseCanvasPos2.x > 0) {
             ctx2.textAlign = 'center'; 
             ctx2.textBaseline = 'top';
             ctx2.font = '32px sans-serif';
             ctx2.fillStyle = isNearTarget2 ? '#10b981' : '#ef4444';
             ctx2.fillText('👆', mouseCanvasPos2.x, mouseCanvasPos2.y);
             
             const coordText = `(${snappedGraphPos2.x.toFixed(0)}, ${snappedGraphPos2.y.toFixed(0)})`;
            
             ctx2.font = 'bold 20px monospace';
             ctx2.textAlign = 'left';
             ctx2.textBaseline = 'middle';
             const textMetrics = ctx2.measureText(coordText);
            
             const tailXBase = mouseCanvasPos2.x;
             const tailY = mouseCanvasPos2.y + 15;
             let rectX, textX;

             rectX = tailXBase + 20;
             textX = rectX + 5;

             if (rectX + textMetrics.width + 10 > canvas2.width) {
                 rectX = tailXBase - 20 - textMetrics.width - 10;
                 textX = rectX + 5;
             }
             
             ctx2.fillStyle = isNearTarget2 ? 'rgba(16, 185, 129, 0.9)' : 'rgba(30, 41, 59, 0.8)';
             ctx2.beginPath();
             ctx2.roundRect(rectX, tailY - 14, textMetrics.width + 10, 28, 7);
             ctx2.fill();
            
             ctx2.fillStyle = '#ffffff';
             ctx2.fillText(coordText, textX, tailY);

             ctx2.textAlign = 'center';
             ctx2.textBaseline = 'alphabetic';
             ctx2.fillStyle = '#1e293b';
        }

        if (lineDrawn2) {
            drawLine2();
            drawTimeSliderVisuals();
            drawDistSliderVisuals();
        }
    }
    
    function drawPoint2(t, d, color = '#4f46e5', radius = 6) {
        if (t > maxX2 || d > maxY2) return;
        const x = padding2 + t * xScale2;
        const y = canvas2.height - padding2 - d * yScale2;
        ctx2.beginPath();
        ctx2.arc(x, y, radius, 0, Math.PI * 2);
        ctx2.fillStyle = color;
        ctx2.fill();
        ctx2.strokeStyle = 'white'; ctx2.lineWidth = 2; ctx2.stroke();
    }
    
    function startManualPlotting2() {
        graphDrawn2 = true;
        plottingMode2 = true;
        currentPointIndex2 = 0;
        plotBtn2.disabled = true;
        updateGraphBounds2();
        drawGraph2();
        plotToolActivator2.classList.remove('hidden');
        activatorFinger2.addEventListener('click', activatePlottingTool2, { once: true });
        updateFeedbackForPlotting2();
    }
    
    function activatePlottingTool2() {
        isToolActive2 = true;
        document.body.classList.add('no-select');
        canvas2.classList.add('plotting-active');
        plotToolActivator2.classList.add('hidden');
        updateFeedbackForPlotting2();

        plotMoveHandler2 = (e) => plotMove(e, 2);
        touchMoveHandler2 = (e) => plotMove(e, 2);
        plotClickHandler2 = (e) => handlePlotClick(e, 2);

        document.addEventListener('mousemove', plotMoveHandler2);
        document.addEventListener('touchmove', touchMoveHandler2, { passive: false });
        document.addEventListener('click', plotClickHandler2);
    }
    
    function updateFeedbackForPlotting2() {
        if (currentPointIndex2 < data2.length) {
            const target = data2[currentPointIndex2];
            feedbackBox2.innerHTML = `புள்ளி குறிக்கும் கருவியை அழுத்தி, வரைபடத்தில் <b>(${target.t}, ${target.d})</b> என்ற புள்ளியைக் கண்டறியவும்.`;
        }
    }

    function drawLine2() {
        if (!pointsPlotted2) return;
        const startX = padding2;
        const startY = canvas2.height - padding2;
        const endX = padding2 + maxX2 * xScale2;
        const endY = canvas2.height - padding2 - (maxX2 * proportionalityConstant) * yScale2;
        ctx2.beginPath();
        ctx2.moveTo(startX, startY);
        ctx2.lineTo(endX, endY);
        ctx2.strokeStyle = '#ef4444'; ctx2.lineWidth = 3; ctx2.stroke();
    }
    
    function drawTimeSliderVisuals() {
        if (!lineDrawn2) return;
        const time = parseFloat(timeSlider.value);
        const distance = time * proportionalityConstant;
        const x = padding2 + time * xScale2;
        const y = canvas2.height - padding2 - distance * yScale2;
        
        ctx2.beginPath(); ctx2.setLineDash([5, 5]); ctx2.strokeStyle = '#10b981'; ctx2.lineWidth = 2;
        ctx2.moveTo(x, canvas2.height - padding2); ctx2.lineTo(x, y); ctx2.lineTo(padding2, y);
        ctx2.stroke(); ctx2.setLineDash([]);
        
        drawPoint2(time, distance, '#10b981', 8);
    }

    function drawDistSliderVisuals() {
        if (!lineDrawn2) return;
        const distance = parseFloat(distSlider.value);
        const time = distance / proportionalityConstant;
        const x = padding2 + time * xScale2;
        const y = canvas2.height - padding2 - distance * yScale2;

        ctx2.beginPath(); ctx2.setLineDash([5, 5]); ctx2.strokeStyle = '#0ea5e9'; ctx2.lineWidth = 2;
        ctx2.moveTo(padding2, y); ctx2.lineTo(x, y); ctx2.lineTo(x, canvas2.height - padding2);
        ctx2.stroke(); ctx2.setLineDash([]);
        
        drawPoint2(time, distance, '#0ea5e9', 8);
    }
    
    function handleTimeSlider() {
        if (!lineDrawn2) return;
        const time = parseFloat(timeSlider.value);
        sliderValue2_time.textContent = time;
        const distance = time * proportionalityConstant;
        resultBox2_dist.innerHTML = `y = kx <br> y = (5/6) * ${time} = ${distance.toFixed(1)} கி.மீ`;
        drawGraph2();
    }

    function handleDistSlider() {
        if (!lineDrawn2) return;
        const distance = parseFloat(distSlider.value);
        sliderValue2_dist.textContent = distance;
        const time = distance / proportionalityConstant;
        resultBox2_time.innerHTML = `x = y/k <br> x = ${distance} / (5/6) = ${time.toFixed(1)} நிமிடங்கள்`;
        drawGraph2();
    }

    function updateTable2() {
        dataTableBody2.innerHTML = '';
        data2.forEach(point => {
            const row = document.createElement('tr');
            row.innerHTML = `<td>${point.t}</td><td>${point.d}</td>`;
            dataTableBody2.appendChild(row);
        });
    }

    function resetSimulation2() {
        pointsPlotted2 = false; lineDrawn2 = false; graphDrawn2 = false; plottingMode2 = false;
        isToolActive2 = false; isNearTarget2 = false; currentPointIndex2 = 0;
        userPlottedPoints2 = [];
        snappedGraphPos2 = { x: -1, y: -1 };

        lineBtn2.disabled = true;
        questionsSection2.classList.add('hidden');
        timeSlider.value = 90;
        distSlider.value = 300;
        canvas2.classList.remove('plotting-active');
        plotToolActivator2.classList.add('hidden');
        
        const newActivator = activatorFinger2.cloneNode(true);
        activatorFinger2.parentNode.replaceChild(newActivator, activatorFinger2);
        activatorFinger2 = newActivator;

        initModel2();
    }
    
    // --- MODEL 3: INVERSE VARIATION ---
    function initModel3() {
        data3 = [];
        feedbackBox3.innerHTML = '<b>அட்டவணையை முடிக்க 4 வேலையாட்கள் (x) மதிப்புகளை உள்ளிடவும்.</b>';
        plotBtn3.disabled = true;
        lineBtn3.disabled = true;
        xInput3.disabled = false;
        addPointBtn3.disabled = false;
        xInput3.value = '';
        updateTable3();
        resizeCanvas3();
    }

    function resizeCanvas3() {
        const container = canvas3.parentElement;
        const size = Math.min(container.clientWidth - 20, container.clientHeight - 20, 800);
        canvas3.width = size;
        canvas3.height = size;
        if (graphDrawn3) {
            updateGraphBounds3();
            drawGraph3();
        } else {
             clearCanvas3();
        }
    }

    function clearCanvas3() {
        ctx3.clearRect(0, 0, canvas3.width, canvas3.height);
        ctx3.fillStyle = '#6b7280';
        ctx3.font = 'bold 16px sans-serif';
        ctx3.textAlign = 'center';
        ctx3.fillText('வரைபடத்தை வரையவும்', canvas3.width / 2, canvas3.height / 2);
    }
    
    function updateGraphBounds3() {
        maxX3 = 200; 
        maxY3 = 300;
        xScale3 = (canvas3.width - 2 * padding3) / maxX3;
        yScale3 = (canvas3.height - 2 * padding3) / maxY3;
        workersSlider3.max = maxX3;
        daysSlider3.max = maxY3;
    }
    
    function drawGraph3() {
        ctx3.clearRect(0, 0, canvas3.width, canvas3.height);

        if (!graphDrawn3) {
            clearCanvas3();
            return;
        }

        // Draw Scale Text
        ctx3.fillStyle = '#1f293b';
        ctx3.font = 'bold 13px sans-serif';
        ctx3.textAlign = 'right';
        ctx3.fillText('அளவுத்திட்டம்:', canvas3.width - 20, padding3 - 15);
        ctx3.font = '13px sans-serif';
        ctx3.fillText('X-அச்சு: 1 செ.மீ = 20 அலகுகள்', canvas3.width - 20, padding3 + 5);
        ctx3.fillText('Y-அச்சு: 1 செ.மீ = 25 அலகுகள்', canvas3.width - 20, padding3 + 25);

        // Axes and Labels
        ctx3.beginPath();
        ctx3.moveTo(padding3, padding3);
        ctx3.lineTo(padding3, canvas3.height - padding3);
        ctx3.lineTo(canvas3.width - padding3, canvas3.height - padding3);
        ctx3.strokeStyle = '#333'; ctx3.lineWidth = 2; ctx3.stroke();
        drawArrow(ctx3, canvas3.width - padding3, canvas3.height - padding3, true);
        drawArrow(ctx3, padding3, padding3, false);
        ctx3.fillStyle = '#1e293b'; ctx3.font = 'bold 16px sans-serif'; ctx3.textAlign = 'center';
        ctx3.fillText('வேலையாட்கள் (x)', canvas3.width / 2, canvas3.height - 15);
        ctx3.save();
        ctx3.translate(20, canvas3.height / 2);
        ctx3.rotate(-Math.PI / 2);
        ctx3.fillText('நாட்கள் (y)', 0, 0);
        ctx3.restore();

        // Ticks and Gridlines
        ctx3.font = 'bold 12px sans-serif';
        ctx3.textAlign = 'center'; ctx3.textBaseline = 'top';
        for (let i = 0; i <= maxX3; i += 20) {
            const x = padding3 + i * xScale3;
            ctx3.fillStyle = '#1e293b';
            ctx3.fillText(i, x, canvas3.height - padding3 + 10);
            if (i > 0) {
                ctx3.beginPath(); ctx3.moveTo(x, canvas3.height - padding3);
                ctx3.lineTo(x, padding3);
                ctx3.lineWidth = 1; ctx3.strokeStyle = '#e2e8f0'; ctx3.stroke();
            }
        }
        ctx3.textAlign = 'right'; ctx3.textBaseline = 'middle';
        for (let i = 0; i <= maxY3; i += 25) {
            const y = canvas3.height - padding3 - i * yScale3;
            if (i >= 0) {
                ctx3.fillStyle = '#1e293b';
                ctx3.fillText(i, padding3 - 10, y);
                if (i > 0) {
                    ctx3.beginPath(); ctx3.moveTo(padding3, y);
                    ctx3.lineTo(canvas3.width - padding3, y);
                    ctx3.lineWidth = 1; ctx3.strokeStyle = '#e2e8f0'; ctx3.stroke();
                }
            }
        }

        userPlottedPoints3.forEach(p => drawPoint3(p.x, p.y, '#4f46e5', 8));
        
        ctx3.font = 'bold 14px sans-serif'; ctx3.fillStyle = '#1e293b';
        ctx3.textAlign = 'left'; ctx3.textBaseline = 'bottom';
        userPlottedPoints3.forEach(p => {
            const xPos = padding3 + p.x * xScale3;
            const yPos = canvas3.height - padding3 - p.y * yScale3;
            ctx3.fillText(`(${p.x}, ${p.y})`, xPos + 10, yPos - 10);
        });

        if (isToolActive3 && mouseCanvasPos3.x > 0) {
             ctx3.textAlign = 'center'; ctx3.textBaseline = 'top'; ctx3.font = '32px sans-serif';
             ctx3.fillStyle = isNearTarget3 ? '#10b981' : '#ef4444';
             ctx3.fillText('👆', mouseCanvasPos3.x, mouseCanvasPos3.y);
             const coordText = `(${snappedGraphPos3.x}, ${snappedGraphPos3.y})`;
             ctx3.font = 'bold 20px monospace'; ctx3.textAlign = 'left'; ctx3.textBaseline = 'middle';
             const textMetrics = ctx3.measureText(coordText);
             const tailXBase = mouseCanvasPos3.x; const tailY = mouseCanvasPos3.y + 15;
             let rectX = tailXBase + 20; let textX = rectX + 5;
             if (rectX + textMetrics.width + 10 > canvas3.width) {
                 rectX = tailXBase - 20 - textMetrics.width - 10; textX = rectX + 5;
             }
             ctx3.fillStyle = isNearTarget3 ? 'rgba(16, 185, 129, 0.9)' : 'rgba(30, 41, 59, 0.8)';
             ctx3.beginPath();
             ctx3.roundRect(rectX, tailY - 14, textMetrics.width + 10, 28, 7);
             ctx3.fill();
             ctx3.fillStyle = '#ffffff'; ctx3.fillText(coordText, textX, tailY);
        }

        if (lineDrawn3) {
            drawLine3();
            drawWorkersSliderVisuals();
            drawDaysSliderVisuals();
        }
    }

    function drawPoint3(xVal, yVal, color = '#4f46e5', radius = 6) {
        if (xVal > maxX3 || yVal > maxY3) return;
        const x = padding3 + xVal * xScale3;
        const y = canvas3.height - padding3 - yVal * yScale3;
        ctx3.beginPath(); ctx3.arc(x, y, radius, 0, Math.PI * 2);
        ctx3.fillStyle = color; ctx3.fill();
        ctx3.strokeStyle = 'white'; ctx3.lineWidth = 2; ctx3.stroke();
    }
    
    function startManualPlotting3() {
        graphDrawn3 = true; plottingMode3 = true; currentPointIndex3 = 0; userPlottedPoints3 = [];
        plotBtn3.disabled = true;
        updateGraphBounds3();
        drawGraph3();
        plotToolActivator3.classList.remove('hidden');
        activatorFinger3.addEventListener('click', activatePlottingTool3, { once: true });
        updateFeedbackForPlotting3();
    }
    
    function activatePlottingTool3() {
        isToolActive3 = true; document.body.classList.add('no-select');
        canvas3.classList.add('plotting-active');
        plotToolActivator3.classList.add('hidden');
        updateFeedbackForPlotting3();
        plotMoveHandler3 = (e) => plotMove(e, 3);
        touchMoveHandler3 = (e) => plotMove(e, 3);
        plotClickHandler3 = (e) => handlePlotClick(e, 3);
        document.addEventListener('mousemove', plotMoveHandler3);
        document.addEventListener('touchmove', touchMoveHandler3, { passive: false });
        document.addEventListener('click', plotClickHandler3);
    }
    
    function updateFeedbackForPlotting3() {
        if (currentPointIndex3 < data3.length) {
            const target = data3[currentPointIndex3];
            feedbackBox3.innerHTML = `புள்ளி குறிக்கும் கருவியை அழுத்தி, வரைபடத்தில் <b>(${target.x}, ${target.y})</b> என்ற புள்ளியைக் கண்டறியவும்.`;
        }
    }

    function drawLine3() {
        if (!pointsPlotted3) return;
        ctx3.beginPath();
        ctx3.strokeStyle = '#ef4444'; ctx3.lineWidth = 3;
        let firstPoint = true;
        for (let xVal = 20; xVal <= maxX3; xVal += 1) {
            const yVal = inverseConstant / xVal;
            if (yVal <= maxY3) {
                const x = padding3 + xVal * xScale3;
                const y = canvas3.height - padding3 - yVal * yScale3;
                if (firstPoint) {
                    ctx3.moveTo(x, y);
                    firstPoint = false;
                } else {
                    ctx3.lineTo(x, y);
                }
            }
        }
        ctx3.stroke();
    }
    
    function drawWorkersSliderVisuals() {
        if (!lineDrawn3) return;
        const workers = parseFloat(workersSlider3.value);
        const days = inverseConstant / workers;
        const x = padding3 + workers * xScale3;
        const y = canvas3.height - padding3 - days * yScale3;
        ctx3.beginPath(); ctx3.setLineDash([5, 5]); ctx3.strokeStyle = '#10b981'; ctx3.lineWidth = 2;
        ctx3.moveTo(x, canvas3.height - padding3); ctx3.lineTo(x, y); ctx3.lineTo(padding3, y);
        ctx3.stroke(); ctx3.setLineDash([]);
        drawPoint3(workers, days, '#10b981', 8);
    }

    function drawDaysSliderVisuals() {
        if (!lineDrawn3) return;
        const days = parseFloat(daysSlider3.value);
        const workers = inverseConstant / days;
        const x = padding3 + workers * xScale3;
        const y = canvas3.height - padding3 - days * yScale3;
        ctx3.beginPath(); ctx3.setLineDash([5, 5]); ctx3.strokeStyle = '#0ea5e9'; ctx3.lineWidth = 2;
        ctx3.moveTo(padding3, y); ctx3.lineTo(x, y); ctx3.lineTo(x, canvas3.height - padding3);
        ctx3.stroke(); ctx3.setLineDash([]);
        drawPoint3(workers, days, '#0ea5e9', 8);
    }
    
    function handleWorkersSlider3() {
        if (!lineDrawn3) return;
        const workers = parseFloat(workersSlider3.value);
        sliderValue3_workers.textContent = workers;
        const days = inverseConstant / workers;
        resultBox3_days.innerHTML = `y = k/x <br> y = ${inverseConstant} / ${workers} = ${days.toFixed(0)} நாட்கள்`;
        drawGraph3();
    }

    function handleDaysSlider3() {
        if (!lineDrawn3) return;
        const days = parseFloat(daysSlider3.value);
        sliderValue3_days.textContent = days;
        const workers = inverseConstant / days;
        resultBox3_workers.innerHTML = `x = k/y <br> x = ${inverseConstant} / ${days} = ${workers.toFixed(0)} வேலையாட்கள்`;
        drawGraph3();
    }

    function updateTable3() {
        dataTableBody3.innerHTML = '';
        data3.forEach(point => {
            const row = document.createElement('tr');
            row.innerHTML = `<td>${point.x}</td><td>${point.y}</td>`;
            dataTableBody3.appendChild(row);
        });
    }

    function resetSimulation3() {
        pointsPlotted3 = false; lineDrawn3 = false; graphDrawn3 = false; plottingMode3 = false;
        isToolActive3 = false; isNearTarget3 = false; currentPointIndex3 = 0;
        userPlottedPoints3 = [];
        snappedGraphPos3 = { x: -1, y: -1 };
        lineBtn3.disabled = true;
        questionsSection3.classList.add('hidden');
        workersSlider3.value = 120;
        daysSlider3.value = 200;
        canvas3.classList.remove('plotting-active');
        plotToolActivator3.classList.add('hidden');
        const newActivator = activatorFinger3.cloneNode(true);
        activatorFinger3.parentNode.replaceChild(newActivator, activatorFinger3);
        activatorFinger3 = newActivator;
        initModel3();
    }

    // --- MODEL 4: xy = 24 ---
    function initModel4() {
        data4 = [];
        feedbackBox4.innerHTML = '<b>xy = 24-க்கான அட்டவணையை முடிக்க 24-ன் 8 காரணிகளை (1, 2, 3, 4, 6, 8, 12, 24) உள்ளிடவும்.</b>';
        plotBtn4.disabled = true;
        generatePointsBtn4.disabled = true;
        lineBtn4.disabled = true;
        xInput4.disabled = false;
        addPointBtn4.disabled = false;
        xInput4.value = '';
        coordinatesDisplay4.classList.add('hidden');
        coordinatesDisplay4.innerHTML = '';
        updateTable4();
        resizeCanvas4();
    }

    function resizeCanvas4() {
        const container = canvas4.parentElement;
        const size = Math.min(container.clientWidth - 20, container.clientHeight - 20, 800);
        canvas4.width = size;
        canvas4.height = size;
        if (graphDrawn4) {
            updateGraphBounds4();
            drawGraph4();
        } else {
             clearCanvas4();
        }
    }

    function clearCanvas4() {
        ctx4.clearRect(0, 0, canvas4.width, canvas4.height);
        ctx4.fillStyle = '#6b7280';
        ctx4.font = 'bold 16px sans-serif';
        ctx4.textAlign = 'center';
        ctx4.fillText('வரைபடத்தை வரையவும்', canvas4.width / 2, canvas4.height / 2);
    }
    
    function updateGraphBounds4() {
        maxX4 = 25; 
        maxY4 = 25;
        xScale4 = (canvas4.width - 2 * padding4) / maxX4;
        yScale4 = (canvas4.height - 2 * padding4) / maxY4;
        xSlider4.max = maxX4;
        ySlider4.max = maxY4;
    }
    
    function drawGraph4() {
        ctx4.clearRect(0, 0, canvas4.width, canvas4.height);

        if (!graphDrawn4) {
            clearCanvas4();
            return;
        }

        // Draw Scale Text
        ctx4.fillStyle = '#1f293b';
        ctx4.font = 'bold 13px sans-serif';
        ctx4.textAlign = 'right';
        ctx4.fillText('அளவுத்திட்டம்:', canvas4.width - 20, padding4 - 15);
        ctx4.font = '13px sans-serif';
        ctx4.fillText('X-அச்சு: 1 செ.மீ = 2 அலகுகள்', canvas4.width - 20, padding4 + 5);
        ctx4.fillText('Y-அச்சு: 1 செ.மீ = 2 அலகுகள்', canvas4.width - 20, padding4 + 25);

        // Axes and Labels
        ctx4.beginPath();
        ctx4.moveTo(padding4, padding4);
        ctx4.lineTo(padding4, canvas4.height - padding4);
        ctx4.lineTo(canvas4.width - padding4, canvas4.height - padding4);
        ctx4.strokeStyle = '#333'; ctx4.lineWidth = 2; ctx4.stroke();
        drawArrow(ctx4, canvas4.width - padding4, canvas4.height - padding4, true);
        drawArrow(ctx4, padding4, padding4, false);
        ctx4.fillStyle = '#1e293b'; ctx4.font = 'bold 16px sans-serif'; ctx4.textAlign = 'center';
        ctx4.fillText('x', canvas4.width / 2, canvas4.height - 15);
        ctx4.save();
        ctx4.translate(20, canvas4.height / 2);
        ctx4.rotate(-Math.PI / 2);
        ctx4.fillText('y', 0, 0);
        ctx4.restore();

        // Ticks and Gridlines
        ctx4.font = 'bold 12px sans-serif';
        ctx4.textAlign = 'center'; ctx4.textBaseline = 'top';
        for (let i = 0; i <= maxX4; i += 2) {
            const x = padding4 + i * xScale4;
            ctx4.fillStyle = '#1e293b';
            ctx4.fillText(i, x, canvas4.height - padding4 + 10);
            if (i > 0) {
                ctx4.beginPath(); ctx4.moveTo(x, canvas4.height - padding4);
                ctx4.lineTo(x, padding4);
                ctx4.lineWidth = 1; ctx4.strokeStyle = '#e2e8f0'; ctx4.stroke();
            }
        }
        ctx4.textAlign = 'right'; ctx4.textBaseline = 'middle';
        for (let i = 0; i <= maxY4; i += 2) {
            const y = canvas4.height - padding4 - i * yScale4;
            if (i > 0) {
                ctx4.fillStyle = '#1e293b';
                ctx4.fillText(i, padding4 - 10, y);
                ctx4.beginPath(); ctx4.moveTo(padding4, y);
                ctx4.lineTo(canvas4.width - padding4, y);
                ctx4.lineWidth = 1; ctx4.strokeStyle = '#e2e8f0'; ctx4.stroke();
            }
        }

        userPlottedPoints4.forEach(p => drawPoint4(p.x, p.y, '#4f46e5', 8));
        
        ctx4.font = 'bold 14px sans-serif'; ctx4.fillStyle = '#1e293b';
        ctx4.textAlign = 'left'; ctx4.textBaseline = 'bottom';
        userPlottedPoints4.forEach(p => {
            const xPos = padding4 + p.x * xScale4;
            const yPos = canvas4.height - padding4 - p.y * yScale4;
            ctx4.fillText(`(${p.x}, ${p.y})`, xPos + 10, yPos - 10);
        });

        if (isToolActive4 && mouseCanvasPos4.x > 0) {
             ctx4.textAlign = 'center'; ctx4.textBaseline = 'top'; ctx4.font = '32px sans-serif';
             ctx4.fillStyle = isNearTarget4 ? '#10b981' : '#ef4444';
             ctx4.fillText('👆', mouseCanvasPos4.x, mouseCanvasPos4.y);
             const coordText = `(${snappedGraphPos4.x}, ${snappedGraphPos4.y})`;
             ctx4.font = 'bold 20px monospace'; ctx4.textAlign = 'left'; ctx4.textBaseline = 'middle';
             const textMetrics = ctx4.measureText(coordText);
             const tailXBase = mouseCanvasPos4.x; const tailY = mouseCanvasPos4.y + 15;
             let rectX = tailXBase + 20; let textX = rectX + 5;
             if (rectX + textMetrics.width + 10 > canvas4.width) {
                 rectX = tailXBase - 20 - textMetrics.width - 10; textX = rectX + 5;
             }
             ctx4.fillStyle = isNearTarget4 ? 'rgba(16, 185, 129, 0.9)' : 'rgba(30, 41, 59, 0.8)';
             ctx4.beginPath();
             ctx4.roundRect(rectX, tailY - 14, textMetrics.width + 10, 28, 7);
             ctx4.fill();
             ctx4.fillStyle = '#ffffff'; ctx4.fillText(coordText, textX, tailY);
        }

        if (lineDrawn4) {
            drawLine4();
            drawXSliderVisuals4();
            drawYSliderVisuals4();
        }
    }

    function drawPoint4(xVal, yVal, color = '#4f46e5', radius = 6) {
        if (xVal > maxX4 || yVal > maxY4 || xVal <=0 || yVal <= 0) return;
        const x = padding4 + xVal * xScale4;
        const y = canvas4.height - padding4 - yVal * yScale4;
        ctx4.beginPath(); ctx4.arc(x, y, radius, 0, Math.PI * 2);
        ctx4.fillStyle = color; ctx4.fill();
        ctx4.strokeStyle = 'white'; ctx4.lineWidth = 2; ctx4.stroke();
    }
    
    function startManualPlotting4() {
        graphDrawn4 = true; plottingMode4 = true; currentPointIndex4 = 0;
        // Sort data before plotting
        data4.sort((a,b) => a.x - b.x);
        userPlottedPoints4 = [];
        plotBtn4.disabled = true;
        updateGraphBounds4();
        drawGraph4();
        plotToolActivator4.classList.remove('hidden');
        activatorFinger4.addEventListener('click', activatePlottingTool4, { once: true });
        updateFeedbackForPlotting4();
    }
    
    function activatePlottingTool4() {
        isToolActive4 = true; document.body.classList.add('no-select');
        canvas4.classList.add('plotting-active');
        plotToolActivator4.classList.add('hidden');
        updateFeedbackForPlotting4();
        plotMoveHandler4 = (e) => plotMove(e, 4);
        touchMoveHandler4 = (e) => plotMove(e, 4);
        plotClickHandler4 = (e) => handlePlotClick(e, 4);
        document.addEventListener('mousemove', plotMoveHandler4);
        document.addEventListener('touchmove', touchMoveHandler4, { passive: false });
        document.addEventListener('click', plotClickHandler4);
    }
    
    function updateFeedbackForPlotting4() {
        if (currentPointIndex4 < data4.length) {
            const target = data4[currentPointIndex4];
            feedbackBox4.innerHTML = `புள்ளி குறிக்கும் கருவியை அழுத்தி, வரைபடத்தில் <b>(${target.x}, ${target.y})</b> என்ற புள்ளியைக் கண்டறியவும்.`;
        }
    }

    function drawLine4() {
        if (!pointsPlotted4) return;
        ctx4.beginPath();
        ctx4.strokeStyle = '#ef4444'; ctx4.lineWidth = 3;
        let firstPoint = true;
        for (let xVal = 1; xVal <= maxX4; xVal += 0.1) {
            const yVal = inverseConstant4 / xVal;
            if (yVal <= maxY4) {
                const x = padding4 + xVal * xScale4;
                const y = canvas4.height - padding4 - yVal * yScale4;
                if (firstPoint) {
                    ctx4.moveTo(x, y);
                    firstPoint = false;
                } else {
                    ctx4.lineTo(x, y);
                }
            }
        }
        ctx4.stroke();
    }
    
    function drawXSliderVisuals4() {
        if (!lineDrawn4) return;
        const xVal = parseFloat(xSlider4.value);
        const yVal = inverseConstant4 / xVal;
        const x = padding4 + xVal * xScale4;
        const y = canvas4.height - padding4 - yVal * yScale4;
        ctx4.beginPath(); ctx4.setLineDash([5, 5]); ctx4.strokeStyle = '#10b981'; ctx4.lineWidth = 2;
        ctx4.moveTo(x, canvas4.height - padding4); ctx4.lineTo(x, y); ctx4.lineTo(padding4, y);
        ctx4.stroke(); ctx4.setLineDash([]);
        drawPoint4(xVal, yVal, '#10b981', 8);
    }

    function drawYSliderVisuals4() {
        if (!lineDrawn4) return;
        const yVal = parseFloat(ySlider4.value);
        const xVal = inverseConstant4 / yVal;
        const x = padding4 + xVal * xScale4;
        const y = canvas4.height - padding4 - yVal * yScale4;
        ctx4.beginPath(); ctx4.setLineDash([5, 5]); ctx4.strokeStyle = '#0ea5e9'; ctx4.lineWidth = 2;
        ctx4.moveTo(padding4, y); ctx4.lineTo(x, y); ctx4.lineTo(x, canvas4.height - padding4);
        ctx4.stroke(); ctx4.setLineDash([]);
        drawPoint4(xVal, yVal, '#0ea5e9', 8);
    }
    
    function handleXSlider4() {
        if (!lineDrawn4) return;
        const xVal = parseFloat(xSlider4.value);
        sliderValue4_x.textContent = xVal;
        const yVal = inverseConstant4 / xVal;
        resultBox4_y.innerHTML = `y = 24/x <br> y = 24 / ${xVal} = ${yVal.toFixed(1)}`;
        drawGraph4();
    }

    function handleYSlider4() {
        if (!lineDrawn4) return;
        const yVal = parseFloat(ySlider4.value);
        sliderValue4_y.textContent = yVal;
        const xVal = inverseConstant4 / yVal;
        resultBox4_x.innerHTML = `x = 24/y <br> x = 24 / ${yVal} = ${xVal.toFixed(1)}`;
        drawGraph4();
    }

    function updateTable4() {
        dataTableBody4.innerHTML = '';
        data4.sort((a, b) => a.x - b.x).forEach(point => {
            const row = document.createElement('tr');
            row.innerHTML = `<td>${point.x}</td><td>&times;</td><td>${point.y}</td><td>=</td><td>24</td>`;
            dataTableBody4.appendChild(row);
        });
    }

    function resetSimulation4() {
        pointsPlotted4 = false; lineDrawn4 = false; graphDrawn4 = false; plottingMode4 = false;
        isToolActive4 = false; isNearTarget4 = false; currentPointIndex4 = 0;
        userPlottedPoints4 = [];
        snappedGraphPos4 = { x: -1, y: -1 };
        lineBtn4.disabled = true;
        questionsSection4.classList.add('hidden');
        xSlider4.value = 3;
        ySlider4.value = 6;
        canvas4.classList.remove('plotting-active');
        plotToolActivator4.classList.add('hidden');
        const newActivator = activatorFinger4.cloneNode(true);
        activatorFinger4.parentNode.replaceChild(newActivator, activatorFinger4);
        activatorFinger4 = newActivator;
        
        coordinatesDisplay4.classList.add('hidden');
        coordinatesDisplay4.innerHTML = '';

        initModel4();
    }
    
    // --- EVENT LISTENERS ---

    // General
    headerTitle.addEventListener('click', () => {
        homeScreen.classList.remove('hidden');
        simulationScreen.classList.add('hidden');
        resetSimulation();
        resetSimulation2();
        resetSimulation3();
        resetSimulation4();
    });

    graphButton.addEventListener('click', () => {
        homeScreen.classList.add('hidden');
        simulationScreen.classList.remove('hidden');
        switchTab('model1');
    });

    tabBtns.forEach(btn => {
        btn.addEventListener('click', () => switchTab(btn.dataset.tab));
    });

    // Model 1
    backBtn.addEventListener('click', () => {
        homeScreen.classList.remove('hidden');
        simulationScreen.classList.add('hidden');
        resetSimulation();
        resetSimulation2();
        resetSimulation3();
        resetSimulation4();
    });

    addPointBtn.addEventListener('click', () => {
        if (data.length >= 5) {
            feedbackBox.textContent = '5 மதிப்புகள் சேர்க்கப்பட்டன.'; return;
        }
        const x = parseFloat(xInput.value);
        if (!isNaN(x) && x > 0) {
            const y = parseFloat((x * 3.1).toFixed(1));
            data.push({ d: x, c: y });
            updateTable();
            xInput.value = ''; xInput.focus();
            if (data.length >= 5) {
                plotBtn.disabled = false;
                xInput.disabled = true; addPointBtn.disabled = true;
                feedbackBox.innerHTML = '<b>5 மதிப்புகள் சேர்க்கப்பட்டன. இப்போது "புள்ளிகளைக் குறிக்கவும்" பொத்தானை அழுத்தவும்.</b>';
            } else {
                 feedbackBox.textContent = `(${x}, ${y}) புள்ளி சேர்க்கப்பட்டது.`;
            }
        } else {
            feedbackBox.textContent = 'விட்டத்திற்கு சரியான நேர்மறை எண்ணை உள்ளிடவும்.';
        }
    });

    plotBtn.addEventListener('click', startManualPlotting);
    
    lineBtn.addEventListener('click', () => {
        if (!pointsPlotted) return;
        lineDrawn = true;
        lineBtn.disabled = true;
        sliderSection.classList.remove('hidden');
        resultBox.classList.remove('hidden');
        feedbackBox.textContent = 'சிறப்பு! இப்போது ஸ்லைடரைப் பயன்படுத்தி வெவ்வேறு விட்டத்திற்கான சுற்றளவைக் கண்டறியவும்.';
        drawGraph();
    });

    diameterSlider.addEventListener('input', handleSliderInput);
    resetBtn.addEventListener('click', resetSimulation);
    
    // Model 2
    backBtn2.addEventListener('click', () => {
        homeScreen.classList.remove('hidden');
        simulationScreen.classList.add('hidden');
        resetSimulation();
        resetSimulation2();
        resetSimulation3();
        resetSimulation4();
    });

    addPointBtn2.addEventListener('click', () => {
        if (data2.length >= 4) {
            feedbackBox2.textContent = '4 மதிப்புகள் ஏற்கனவே சேர்க்கப்பட்டுள்ளன.';
            return;
        }

        const t = parseFloat(xInput2.value);
        if (!isNaN(t) && t > 0) {
            const d = parseFloat((t * proportionalityConstant).toFixed(1));
            data2.push({ t, d });
            updateTable2();
            xInput2.value = '';
            xInput2.focus();

            if (data2.length === 4) {
                feedbackBox2.innerHTML = '<b>அருமை! இப்போது வரைபடத்தில் "புள்ளிகளைக் குறிக்கவும்".</b>';
                plotBtn2.disabled = false;
                xInput2.disabled = true;
                addPointBtn2.disabled = true;
            } else {
                feedbackBox2.textContent = `(${t}, ${d}) புள்ளி சேர்க்கப்பட்டது. மீதமுள்ள ${4 - data2.length} மதிப்புகளை உள்ளிடவும்.`;
            }
        } else {
            feedbackBox2.textContent = 'நேரத்திற்கு சரியான நேர்மறை எண்ணை உள்ளிடவும்.';
        }
    });

    plotBtn2.addEventListener('click', startManualPlotting2);
    
    lineBtn2.addEventListener('click', () => {
        if (!pointsPlotted2) return;
        lineDrawn2 = true;
        lineBtn2.disabled = true;
        questionsSection2.classList.remove('hidden');
        
        resultBox2_k.textContent = 'k = y/x = 50 கி.மீ / 60 நிமிடங்கள் = 5/6';
        
        const initialTime = parseFloat(timeSlider.value);
        const initialDistance = initialTime * proportionalityConstant;
        resultBox2_dist.innerHTML = `y = kx <br> y = (5/6) * ${initialTime} = ${initialDistance.toFixed(1)} கி.மீ`;
        
        const initialDist = parseFloat(distSlider.value);
        const initialTimeForDist = initialDist / proportionalityConstant;
        resultBox2_time.innerHTML = `x = y/k <br> x = ${initialDist} / (5/6) = ${initialTimeForDist.toFixed(1)} நிமிடங்கள்`;

        feedbackBox2.textContent = 'சிறப்பு! இப்போது ஸ்லைடர்களைப் பயன்படுத்தி கேள்விகளுக்கு விடையளிக்கவும்.';
        drawGraph2();
    });
    
    timeSlider.addEventListener('input', handleTimeSlider);
    distSlider.addEventListener('input', handleDistSlider);
    resetBtn2.addEventListener('click', resetSimulation2);
    
    // Model 3
    backBtn3.addEventListener('click', () => {
        homeScreen.classList.remove('hidden');
        simulationScreen.classList.add('hidden');
        resetSimulation();
        resetSimulation2();
        resetSimulation3();
        resetSimulation4();
    });

    addPointBtn3.addEventListener('click', () => {
        if (data3.length >= 4) {
            feedbackBox3.textContent = '4 மதிப்புகள் ஏற்கனவே சேர்க்கப்பட்டுள்ளன.';
            return;
        }

        const x = parseFloat(xInput3.value);
        if (!isNaN(x) && x > 0) {
            const y = Math.round(inverseConstant / x);
            data3.push({ x, y });
            updateTable3();
            xInput3.value = '';
            xInput3.focus();

            if (data3.length === 4) {
                feedbackBox3.innerHTML = '<b>அருமை! இப்போது வரைபடத்தில் "புள்ளிகளைக் குறிக்கவும்".</b>';
                plotBtn3.disabled = false;
                xInput3.disabled = true;
                addPointBtn3.disabled = true;
            } else {
                feedbackBox3.textContent = `(${x}, ${y}) புள்ளி சேர்க்கப்பட்டது. மீதமுள்ள ${4 - data3.length} மதிப்புகளை உள்ளிடவும்.`;
            }
        } else {
            feedbackBox3.textContent = 'வேலையாட்களுக்கு சரியான நேர்மறை எண்ணை உள்ளிடவும்.';
        }
    });

    plotBtn3.addEventListener('click', startManualPlotting3);
    
    lineBtn3.addEventListener('click', () => {
        if (!pointsPlotted3) return;
        lineDrawn3 = true;
        lineBtn3.disabled = true;
        questionsSection3.classList.remove('hidden');
        resultBox3_k.textContent = 'இது ஒரு எதிர் மாறுபாடு (xy = k)';
        handleWorkersSlider3();
        handleDaysSlider3();
        feedbackBox3.textContent = 'சிறப்பு! இப்போது ஸ்லைடர்களைப் பயன்படுத்தி கேள்விகளுக்கு விடையளிக்கவும்.';
        drawGraph3();
    });
    
    workersSlider3.addEventListener('input', handleWorkersSlider3);
    daysSlider3.addEventListener('input', handleDaysSlider3);
    resetBtn3.addEventListener('click', resetSimulation3);
    
    // Model 4
    backBtn4.addEventListener('click', () => {
        homeScreen.classList.remove('hidden');
        simulationScreen.classList.add('hidden');
        resetSimulation();
        resetSimulation2();
        resetSimulation3();
        resetSimulation4();
    });

    addPointBtn4.addEventListener('click', () => {
        const validFactors = [1, 2, 3, 4, 6, 8, 12, 24];
        const x = parseInt(xInput4.value, 10);

        if (data4.length >= 8) {
            feedbackBox4.textContent = '8 மதிப்புகள் ஏற்கனவே சேர்க்கப்பட்டுள்ளன.';
            return;
        }
        
        const isDuplicate = data4.some(p => p.x === x);
        if (isDuplicate) {
            feedbackBox4.textContent = `${x} ஏற்கனவே சேர்க்கப்பட்டது. வேறு காரணியை உள்ளிடவும்.`;
            feedbackBox4.style.backgroundColor = '#fee2e2';
            feedbackBox4.style.color = '#b91c1c';
            xInput4.value = '';
            xInput4.focus();
            setTimeout(() => {
                feedbackBox4.textContent = `மீதமுள்ள ${8 - data4.length} மதிப்புகளை உள்ளிடவும்.`;
                feedbackBox4.style.backgroundColor = '#eef2ff';
                feedbackBox4.style.color = 'var(--primary-dark)';
            }, 2500);
            return;
        }

        if (!isNaN(x) && validFactors.includes(x)) {
            const y = inverseConstant4 / x;
            data4.push({ x, y });
            updateTable4();
            xInput4.value = '';
            xInput4.focus();

            if (data4.length >= 8) {
                feedbackBox4.innerHTML = '<b>அருமை! இப்போது "புள்ளிகளை உருவாக்கவும்" பொத்தானை அழுத்தவும்.</b>';
                generatePointsBtn4.disabled = false;
                xInput4.disabled = true;
                addPointBtn4.disabled = true;
            } else {
                feedbackBox4.textContent = `(${x}, ${y}) புள்ளி சேர்க்கப்பட்டது. மீதமுள்ள ${8 - data4.length} மதிப்புகளை உள்ளிடவும்.`;
            }
        } else {
            feedbackBox4.textContent = `${x} என்பது 24-ன் சரியான காரணி அல்ல. (1, 2, 3, 4, 6, 8, 12, 24) இவற்றில் ஒன்றை உள்ளிடவும்.`;
            feedbackBox4.style.backgroundColor = '#fee2e2';
            feedbackBox4.style.color = '#b91c1c';
            xInput4.value = '';
            xInput4.focus();

            setTimeout(() => {
                feedbackBox4.textContent = `மீதமுள்ள ${8 - data4.length} மதிப்புகளை உள்ளிடவும்.`;
                feedbackBox4.style.backgroundColor = '#eef2ff';
                feedbackBox4.style.color = 'var(--primary-dark)';
            }, 2500);
        }
    });

    generatePointsBtn4.addEventListener('click', () => {
        if (data4.length < 8) return;
        const coordinatesText = data4
            .sort((a, b) => a.x - b.x) // Sort to ensure order
            .map(p => `<b>(${p.x}, ${p.y})</b>`)
            .join(', ');
        coordinatesDisplay4.innerHTML = coordinatesText;
        coordinatesDisplay4.classList.remove('hidden');
        generatePointsBtn4.disabled = true;
        plotBtn4.disabled = false;
        feedbackBox4.innerHTML = '<b>இப்போது வரைபடத்தில் "புள்ளிகளைக் குறிக்கவும்".</b>';
    });

    plotBtn4.addEventListener('click', startManualPlotting4);
    
    lineBtn4.addEventListener('click', () => {
        if (!pointsPlotted4) return;
        lineDrawn4 = true;
        lineBtn4.disabled = true;
        questionsSection4.classList.remove('hidden');
        handleXSlider4();
        handleYSlider4();
        feedbackBox4.textContent = 'சிறப்பு! இப்போது ஸ்லைடர்களைப் பயன்படுத்தி கேள்விகளுக்கு விடையளிக்கவும்.';
        drawGraph4();
    });
    
    xSlider4.addEventListener('input', handleXSlider4);
    ySlider4.addEventListener('input', handleYSlider4);
    resetBtn4.addEventListener('click', resetSimulation4);


    // Initial setup
    clearCanvas();
    clearCanvas2();
    clearCanvas3();
    clearCanvas4();

</script>

</body>
</html>


